"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[2314],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return f}});var l=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,l,a=function(e,n){if(null==e)return{};var t,l,a={},i=Object.keys(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=l.createContext({}),s=function(e){var n=l.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=s(e.components);return l.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},d=l.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(t),f=a,m=d["".concat(p,".").concat(f)]||d[f]||c[f]||i;return t?l.createElement(m,r(r({ref:n},u),{},{components:t})):l.createElement(m,r({ref:n},u))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=d;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,r[1]=o;for(var s=2;s<i;s++)r[s]=t[s];return l.createElement.apply(null,r)}return l.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4947:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return u},default:function(){return d}});var l=t(7462),a=t(3366),i=(t(7294),t(3905)),r=["components"],o={},p="How to Enable TLS for OpenStack using Kolla Ansible",s={unversionedId:"operators-manual/day-4/kolla-ansible/enable-tls",id:"operators-manual/day-4/kolla-ansible/enable-tls",title:"How to Enable TLS for OpenStack using Kolla Ansible",description:"Introduction",source:"@site/docs/operators-manual/day-4/kolla-ansible/enable-tls.md",sourceDirName:"operators-manual/day-4/kolla-ansible",slug:"/operators-manual/day-4/kolla-ansible/enable-tls",permalink:"/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/enable-tls",editUrl:"https://github.com/inmotionhosting/openmetal-docs/blob/main/docs/operators-manual/day-4/kolla-ansible/enable-tls.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How to Enable Elasticsearch and Kibana using Kolla Ansible",permalink:"/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/enable-elk"},next:{title:"How to Redeploy OpenStack's RabbitMQ Cluster using Kolla Ansible",permalink:"/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/redeploy-rabbitmq"}},u=[{value:"Introduction",id:"introduction",children:[],level:2},{value:"Table of Contents",id:"table-of-contents",children:[],level:2},{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Specify an External Fully Qualified Domain Name for Horizon",id:"specify-an-external-fully-qualified-domain-name-for-horizon",children:[{value:"Determine Public IP",id:"determine-public-ip",children:[],level:3},{value:"Configure an FQDN",id:"configure-an-fqdn",children:[],level:3},{value:"Apply Configuration Change Using Kolla Ansible",id:"apply-configuration-change-using-kolla-ansible",children:[],level:3}],level:2},{value:"Enable SSL Externally, Encrypting Horizon Traffic",id:"enable-ssl-externally-encrypting-horizon-traffic",children:[{value:"Modify Kolla Ansible Configuration",id:"modify-kolla-ansible-configuration",children:[{value:"Configure Root CA Bundle",id:"configure-root-ca-bundle",children:[],level:4},{value:"Prepare SSL File",id:"prepare-ssl-file",children:[],level:4},{value:"Specify SSL Certificate",id:"specify-ssl-certificate",children:[],level:4},{value:"Enable External TLS",id:"enable-external-tls",children:[],level:4},{value:"Reconfigure Cloud using Kolla Ansible",id:"reconfigure-cloud-using-kolla-ansible",children:[],level:4}],level:3}],level:2},{value:"Reconfigure Ceph Cluster using Ceph Ansible",id:"reconfigure-ceph-cluster-using-ceph-ansible",children:[{value:"Procedure",id:"procedure",children:[],level:3}],level:2},{value:"Reference",id:"reference",children:[],level:2}],c={toc:u};function d(e){var n=e.components,t=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,l.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-enable-tls-for-openstack-using-kolla-ansible"},"How to Enable TLS for OpenStack using Kolla Ansible"),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"By default, Private Clouds are not configured with an SSL encrypting the\nnetwork traffic from your machine to your Private Cloud's OpenStack\ndashboard, called Horizon. Without encryption, information is sent in\nplaintext, meaning someone could see the password you used to log in to\nHorizon. In this guide, we explain how to configure an SSL for the\npublic, or external, network of your Private Cloud."),(0,i.kt)("h2",{id:"table-of-contents"},"Table of Contents"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"enable-tls#prerequisites"},"Prerequisites"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"enable-tls#specify-an-external-fully-qualified-domain-name-for-horizon"},"Specify an External Fully Qualified Domain Name for\nHorizon")),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#determine-public-ip"},"Determine Public\nIP")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#configure-an-fqdn"},"Configure an\nFQDN")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#apply-configuration-change-using-kolla-ansible"},"Apply Configuration Change Using Kolla\nAnsible")))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"enable-tls#enable-ssl-externally-encrypting-horizon-traffic"},"Enable SSL Externally, Encrypting Horizon\nTraffic")),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#modify-kolla-ansible-configuration"},"Modify Kolla Ansible\nConfiguration")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#configure-root-ca-bundle"},"Configure Root CA\nBundle")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#prepare-ssl-file"},"Prepare SSL\nFile")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#specify-ssl-certificate"},"Specify SSL\nCertificate")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#enable-external-tls"},"Enable External\nTLS")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#reconfigure-cloud-using-kolla-ansible"},"Reconfigure Cloud using Kolla\nAnsible")))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"enable-tls#reconfigure-ceph-cluster-using-ceph-ansible"},"Reconfigure Ceph Cluster using Ceph\nAnsible")),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"enable-tls#procedure"},"Procedure")))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"enable-tls#reference"},"Reference")))),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Prepare Kolla Ansible"),": This guide explains how to configure your\ncloud with an SSL using Kolla Ansible. Any time you work with Kolla\nAnsible, you must prepare a shell environment. For more, see ",(0,i.kt)("a",{parentName:"li",href:"./"},"How to\nPrepare and Use Kolla\nAnsible"),".\nThe remaining instruction assume this environment has been prepared.\nAll commands are to be executed from the control plane node where\nthis environment has been prepared."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Prepare Ceph Ansible"),": This guide makes use of Ceph Ansible to\nreconfigure your cloud's Ceph cluster. When working with Ceph\nAnsible, you must first prepare a shell environment. For more, see\n",(0,i.kt)("a",{parentName:"li",href:"../ceph-ansible/"},"How to Prepare and Use Ceph\nAnsible"),". The\nportion of this guide that has to do with using Ceph Ansible assumes\nthis environment has been prepared."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Root Access"),": Root access to your cloud's control plane nodes is\nrequired."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Provide your own SSL Files"),': This guide requires the private key,\ncertificate and intermediate chain. Your certificate and\nintermediate chain may be combined as a "Full Chain".')),(0,i.kt)("h2",{id:"specify-an-external-fully-qualified-domain-name-for-horizon"},"Specify an External Fully Qualified Domain Name for Horizon"),(0,i.kt)("p",null,"Before configuring your cloud with an SSL, a Fully Qualified Domain Name\n(FQDN) must be configured. The FQDN should have its DNS A record\nadjusted to point to the public IP of your cloud. This section explains\nhow to prepare your cloud with an FQDN and how to determine the public\nIP of your cloud."),(0,i.kt)("h3",{id:"determine-public-ip"},"Determine Public IP"),(0,i.kt)("p",null,"Within ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml"),", your cloud's public IP is defined by\nthe key ",(0,i.kt)("inlineCode",{parentName:"p"},"kolla_external_vip_address"),"."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ grep kolla_external_vip_address /etc/kolla/globals.yml\nkolla_external_vip_address: 173.231.254.164\n")),(0,i.kt)("p",null,"For this example, the FQDN selected should have a DNS A record pointed\nto ",(0,i.kt)("strong",{parentName:"p"},"173.231.254.164"),". Ensure your FQDN's A record is pointed to the\nvalue defined by ",(0,i.kt)("inlineCode",{parentName:"p"},"kolla_external_vip_address")," within your cloud's\n",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml"),"."),(0,i.kt)("h3",{id:"configure-an-fqdn"},"Configure an FQDN"),(0,i.kt)("p",null,"To specify a domain name for Horizon, within ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml"),",\nset the value for ",(0,i.kt)("inlineCode",{parentName:"p"},"kolla_external_fqdn")," to the domain of your choosing.\n",(0,i.kt)("strong",{parentName:"p"},"Note")," your ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")," may not have a line containing\n",(0,i.kt)("inlineCode",{parentName:"p"},"kolla_external_fqdn"),". If this line is not present, append it the file."),(0,i.kt)("p",null,"For example, to set the FQDN for a cloud to be ",(0,i.kt)("strong",{parentName:"p"},"cloud.domain.com"),",\nuse:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kolla_external_fqdn: cloud.domain.com\n")),(0,i.kt)("h3",{id:"apply-configuration-change-using-kolla-ansible"},"Apply Configuration Change Using Kolla Ansible"),(0,i.kt)("p",null,"With the FQDN configured, Kolla Ansible must be used to apply that\nconfiguration before proceeding with this guide. Before proceeding with\nthis section, ensure you have ",(0,i.kt)("a",{parentName:"p",href:"./"},"prepared a Kolla Ansible\nenvironment"),".\nAlso ensure the node from which Kolla Ansible has been prepared contains\nthe file ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy/kolla-ansible-inventory"),", which is the Ansible\ninventory file for your cloud."),(0,i.kt)("p",null,"To configure the cloud to use this FQDN, use the inventory file\n",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy/kolla-ansible-inventory")," and Kolla Ansible's\n",(0,i.kt)("inlineCode",{parentName:"p"},"reconfigure")," subcommand."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kolla-ansible -i /etc/fm-deploy/kolla-ansible-inventory reconfigure\n")),(0,i.kt)("h2",{id:"enable-ssl-externally-encrypting-horizon-traffic"},"Enable SSL Externally, Encrypting Horizon Traffic"),(0,i.kt)("p",null,"This section outlines the steps required to install a signed SSL for\nyour cloud's external, public network using Kolla Ansible."),(0,i.kt)("h3",{id:"modify-kolla-ansible-configuration"},"Modify Kolla Ansible Configuration"),(0,i.kt)("h4",{id:"configure-root-ca-bundle"},"Configure Root CA Bundle"),(0,i.kt)("p",null,"OpenMetal private clouds are deployed with CentOS 8 as the operating\nsystem. Kolla Ansible needs to be updated to point to the root CA bundle\nfor CentOS 8. To do so, modify ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")," to reflect the\nlocation of the root CA bundle for CentOS 8:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"openstack_cacert: '/etc/pki/tls/certs/ca-bundle.crt'\n")),(0,i.kt)("h4",{id:"prepare-ssl-file"},"Prepare SSL File"),(0,i.kt)("p",null,"Your SSL files need to be prepared into a single file of ",(0,i.kt)("strong",{parentName:"p"},"PEM")," format,\nincluding the private key, certificate, and intermediate chain. When\npreparing the file ensure the order of the information is the private\nkey first, then the certificate, and finally the intermediate chain."),(0,i.kt)("p",null,"To prepare your SSL, concatenate the contents of the private key, the\ncertificate, and the intermediary chain into single file located\n",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/certificates/<certificate-name>.pem"),", where\n",(0,i.kt)("inlineCode",{parentName:"p"},"<certificate-name>")," is the name of the certificate file."),(0,i.kt)("p",null,"Additionally, ensure ",(0,i.kt)("inlineCode",{parentName:"p"},"0600")," permissions are set for the certificate\nfile:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"chmod 0600 /etc/kolla/certificates/<certificate-name>.pem\n")),(0,i.kt)("p",null,"As an example, here's truncated output including the headers of a\nprepared SSL PEM file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"-----BEGIN PRIVATE KEY----- <-- Private Key\n-----END PRIVATE KEY-----\n-----BEGIN CERTIFICATE----- <-- Certificate\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE----- <-- Intermediary Certificate #1\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE----- <-- Intermediary Certificate #2\n-----END CERTIFICATE-----\n")),(0,i.kt)("p",null,"Ensure your SSL PEM file reflects the above ordering otherwise Kolla\nAnsible may fail to execute as expected."),(0,i.kt)("h4",{id:"specify-ssl-certificate"},"Specify SSL Certificate"),(0,i.kt)("p",null,"Next, in ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml"),", ensure the key\n",(0,i.kt)("inlineCode",{parentName:"p"},"kolla_external_fqdn_cert")," is set to the name of the certificate file.\n",(0,i.kt)("inlineCode",{parentName:"p"},"{{ node_config }}")," in this case is defined as ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla"),"."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kolla_external_fqdn_cert: '{{ node_config }}/certificates/<certificate-name>.pem'\n")),(0,i.kt)("h4",{id:"enable-external-tls"},"Enable External TLS"),(0,i.kt)("p",null,"Within ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml"),", ensure ",(0,i.kt)("inlineCode",{parentName:"p"},"kolla_enable_tls_external")," is\nset to ",(0,i.kt)("inlineCode",{parentName:"p"},"'yes'"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kolla_enable_tls_external: 'yes'\n")),(0,i.kt)("h4",{id:"reconfigure-cloud-using-kolla-ansible"},"Reconfigure Cloud using Kolla Ansible"),(0,i.kt)("p",null,"The previous steps conclude the preparation of the SSL file and the\nKolla Ansible configuration. Before proceeding with this step, ensure\nyou have ",(0,i.kt)("a",{parentName:"p",href:"./"},"prepared a Kolla Ansible\nenvironment"),"."),(0,i.kt)("p",null,"Next, to configure the cloud to use this SSL, use the inventory file\n",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy/kolla-ansible-inventory")," and Kolla Ansible's\n",(0,i.kt)("inlineCode",{parentName:"p"},"reconfigure")," subcommand."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kolla-ansible -i /etc/fm-deploy/kolla-ansible-inventory reconfigure\n")),(0,i.kt)("h2",{id:"reconfigure-ceph-cluster-using-ceph-ansible"},"Reconfigure Ceph Cluster using Ceph Ansible"),(0,i.kt)("p",null,"Additionally, the Ceph cluster needs to be reconfigured to update Swift\nto point to the Keystone HTTPS endpoint instead of the HTTP version. In\nthis section we explain how to configure the new Swift endpoint using\nCeph Ansible."),(0,i.kt)("h3",{id:"procedure"},"Procedure"),(0,i.kt)("p",null,"First, ensure you have ",(0,i.kt)("a",{parentName:"p",href:"../ceph-ansible"},"prepared a Ceph Ansible\nenvironment"),"."),(0,i.kt)("p",null,"Next, load ",(0,i.kt)("inlineCode",{parentName:"p"},"./group_vars/all.yml")," in an editor and find the line\ncontaining the string ",(0,i.kt)("inlineCode",{parentName:"p"},"rgw keystone url:"),". For this example, this line\nappears this way:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"rgw keystone url: http://173.231.254.164:5000\n")),(0,i.kt)("p",null,"This line tells Swift which URL to use to authenticate with Keystone.\nSince the cloud now has an SSL configured externally, the Keystone URL\nfor Swift needs to include the HTTPS protocol."),(0,i.kt)("p",null,"In the file ",(0,i.kt)("inlineCode",{parentName:"p"},"./group_vars/all.yml"),", ensure the line with ",(0,i.kt)("inlineCode",{parentName:"p"},"rgw keystone\nurl:")," now specifies HTTPS instead of HTTP. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"rgw keystone url: https://173.231.254.164:5000\n")),(0,i.kt)("p",null,"Next, run Ceph Ansible, using:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ansible-playbook \\\n    -i /etc/fm-deploy/ceph-inventory.yml \\\n    --private-key /root/.ssh/fm-deploy \\\n    /opt/ceph-ansible/site.yml\n")),(0,i.kt)("h2",{id:"reference"},"Reference"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.openstack.org/kolla-ansible/victoria/admin/tls.html"},"TLS Documentation from Kolla Ansible for OpenStack\nVictoria")))}d.isMDXComponent=!0}}]);