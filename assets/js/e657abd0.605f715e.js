"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[3087],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=s(n),m=r,h=u["".concat(p,".").concat(m)]||u[m]||d[m]||a;return n?o.createElement(h,l(l({ref:t},c),{},{components:n})):o.createElement(h,l({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[u]="string"==typeof e?e:r,l[1]=i;for(var s=2;s<a;s++)l[s]=n[s];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8778:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>s});var o=n(7462),r=(n(7294),n(3905));const a={},l="How to Prepare and Use Ceph Ansible",i={unversionedId:"operators-manual/day-4/ceph-ansible/prepare-ceph-ansible",id:"operators-manual/day-4/ceph-ansible/prepare-ceph-ansible",title:"How to Prepare and Use Ceph Ansible",description:"Introduction",source:"@site/docs/operators-manual/day-4/ceph-ansible/prepare-ceph-ansible.md",sourceDirName:"operators-manual/day-4/ceph-ansible",slug:"/operators-manual/day-4/ceph-ansible/prepare-ceph-ansible",permalink:"/docs/manuals/operators-manual/day-4/ceph-ansible/prepare-ceph-ansible",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/operators-manual/day-4/ceph-ansible/prepare-ceph-ansible.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Security and Your OpenMetal Private Cloud",permalink:"/docs/manuals/operators-manual/day-4/security/security-best-practices"},next:{title:"OpenStack Watcher Demonstration",permalink:"/docs/manuals/operators-manual/day-4/watcher/watcher-demo"}},p={},s=[{value:"Introduction",id:"introduction",level:2},{value:"Before Proceeding",id:"before-proceeding",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Root Access to OpenStack Control Plane",id:"root-access-to-openstack-control-plane",level:3},{value:"Path to the Ceph Configuration Files",id:"path-to-the-ceph-configuration-files",level:3},{value:"Preparation",id:"preparation",level:2}],c={toc:s};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-prepare-and-use-ceph-ansible"},"How to Prepare and Use Ceph Ansible"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Should you want to reconfigure your Private Cloud's Ceph cluster, you\ncan do so using Ceph Ansible. In this guide, we explain how to prepare\nan environment from which Ceph Ansible can be used. Making specific\nconfiguration changes to your Ceph cluster is outside the scope of this\nguide."),(0,r.kt)("h2",{id:"before-proceeding"},"Before Proceeding"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"WARNING","!")," -- Our current deployment system deploys a Private Cloud\nwith a known working state. Should you deviate from this state by\nadjusting your cloud's Ceph configuration you can no longer safely use\nthe functions in OpenMetal Central to add nodes to your cloud or add IP\nblocks. Should you use these functions, any custom configurations to\nCeph will be reverted. We are working on rolling out a new deployment\nsystem allowing custom cloud configurations. We can still add new nodes\nand IP blocks to your cloud but must do so manually. Please reach out to\nyour Account Manager should this apply to you."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"root-access-to-openstack-control-plane"},"Root Access to OpenStack Control Plane"),(0,r.kt)("p",null,"Root access to your cloud's control plane nodes is required."),(0,r.kt)("h3",{id:"path-to-the-ceph-configuration-files"},"Path to the Ceph Configuration Files"),(0,r.kt)("admonition",{title:"New Clouds",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"On clouds provisioned ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"after")," Dec 2022")," you will need to open a\n",(0,r.kt)("a",{parentName:"p",href:"/docs/manuals/operators-manual/day-1/intro-to-openmetal-private-cloud#how-to-submit-a-support-ticket"},"support ticket"),"\nto have the configuration saved to your nodes.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ceph Ansible Inventory",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/etc/fm-deploy/ceph-inventory.yml")))),(0,r.kt)("li",{parentName:"ul"},"Ceph Ansible Config",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/opt/ceph-ansible/group_vars/all.yml"))))),(0,r.kt)("h2",{id:"preparation"},"Preparation"),(0,r.kt)("p",null,"To prepare Ceph Ansible:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker cp fm-deploy:/opt/ceph-ansible /opt/ceph-ansible\nchmod 700 /opt/ceph-ansible\ncd /opt/ceph-ansible\nvirtualenv .venv\nsource .venv/bin/activate\npip install -r requirements.txt\npip install six\n")),(0,r.kt)("p",null,"Deploy a Ceph Cluster:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ansible-playbook \\\n    -i /etc/fm-deploy/ceph-inventory.yml \\\n    --private-key /root/.ssh/fm-deploy \\\n    /opt/ceph-ansible/site.yml\n")),(0,r.kt)("p",null,"Attempt to repair a broken Ceph cluster:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ansible-playbook \\\n    -i /etc/fm-deploy/ceph-inventory.yml \\\n    --private-key /root/.ssh/fm-deploy \\\n    /opt/ceph-ansible/site.yml\n")))}u.isMDXComponent=!0}}]);