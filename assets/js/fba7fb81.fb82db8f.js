"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[8565],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=o,h=p["".concat(l,".").concat(m)]||p[m]||u[m]||r;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4064:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const r={},i="Securing a Proxmox VE Bare Metal Host",s={unversionedId:"baremetal/tutorials/securing-proxmox-node",id:"baremetal/tutorials/securing-proxmox-node",title:"Securing a Proxmox VE Bare Metal Host",description:"Author: Nemanja Ilic",source:"@site/docs/baremetal/tutorials/securing-proxmox-node.md",sourceDirName:"baremetal/tutorials",slug:"/baremetal/tutorials/securing-proxmox-node",permalink:"/docs/manuals/baremetal/tutorials/securing-proxmox-node",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/baremetal/tutorials/securing-proxmox-node.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installing Proxmox VE on Bare Metal",permalink:"/docs/manuals/baremetal/tutorials/installing-proxmox-VE-on-bare-metal"},next:{title:"Enabling Intel TDX on Bare Metal",permalink:"/docs/manuals/baremetal/tutorials/tdx-guide"}},l={},c=[{value:"Secure Access to the Management Interface",id:"secure-access-to-the-management-interface",level:2},{value:"Harden SSH Access",id:"harden-ssh-access",level:2},{value:"Apply a Minimal Host Firewall",id:"apply-a-minimal-host-firewall",level:2},{value:"Keep the System Updated and Lean",id:"keep-the-system-updated-and-lean",level:2},{value:"Monitor Logs and Backups",id:"monitor-logs-and-backups",level:2},{value:"Final Thoughts",id:"final-thoughts",level:2}],d={toc:c};function p(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"securing-a-proxmox-ve-bare-metal-host"},"Securing a Proxmox VE Bare Metal Host"),(0,o.kt)("p",null,"Author: Nemanja Ilic"),(0,o.kt)("p",null,"When Proxmox VE is deployed directly on bare metal, especially in a public or\ninternet-reachable environment, taking a few basic hardening steps early can\nsignificantly reduce risk. Proxmox itself is a mature and secure platform, but\nlike any powerful management system, its default exposure should be tightened\nbefore hosting production workloads."),(0,o.kt)("h2",{id:"secure-access-to-the-management-interface"},"Secure Access to the Management Interface"),(0,o.kt)("p",null,"The Proxmox web interface provides full administrative control over the host\nand all virtual machines. Community best practices strongly recommend limiting\naccess to this interface wherever possible."),(0,o.kt)("p",null,"If feasible, expose the Proxmox UI only on a dedicated management network or\nrestrict access to known administrator IP addresses using firewall rules. To\ndo this, open the Proxmox web interface, select your node, navigate to\n",(0,o.kt)("strong",{parentName:"p"},"Firewall"),", and add inbound rules that allow access only from trusted\nadministrator IPs."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Rules",src:n(31494).Z,width:"2172",height:"242"})),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("strong",{parentName:"p"},"Important:")," Be extremely cautious when adding firewall rules. Enabling the\nfirewall without proper allow rules may result in losing access to the node.")),(0,o.kt)("p",null,"The example above is just a small set of rules added to ",(0,o.kt)("strong",{parentName:"p"},"Node Firewall"),"."),(0,o.kt)("p",null,"Avoid using the root account for daily administration where possible. Instead,\nuse dedicated administrative users for managing Proxmox and limit root access\nto maintenance tasks."),(0,o.kt)("p",null,"In addition, enable two-factor authentication (2FA) for all administrative\nusers. Proxmox supports TOTP-based 2FA out of the box and this is widely\nrecommended in official documentation and forums. Below is a walkthrough on how\nyou can create a new administrative user and enable two-factor authentication\nfor that user."),(0,o.kt)("p",null,"In Proxmox UI, from the left side menu, select ",(0,o.kt)("strong",{parentName:"p"},"Datacenter"),". From the\nDatacenter menu, expand ",(0,o.kt)("strong",{parentName:"p"},"Permissions"),", select ",(0,o.kt)("strong",{parentName:"p"},"Users")," and then click\n",(0,o.kt)("strong",{parentName:"p"},"Add"),". The options you may choose are listed in the screenshot below:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Add User",src:n(90597).Z,width:"1240",height:"766"})),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("strong",{parentName:"p"},"Important:")," When using OATH/TOTP authentication, a Key ID is required. One\nway to generate a compatible key is by running the ",(0,o.kt)("inlineCode",{parentName:"p"},"oathkeygen")," command on the\nProxmox node and entering the generated value into the ",(0,o.kt)("strong",{parentName:"p"},"Key IDs")," field.")),(0,o.kt)("p",null,"Once this is done, click Add button to create a new user. Next we will need to\nadd permissions for this user. To do that, head over to Permissions menu, click\n",(0,o.kt)("strong",{parentName:"p"},"Add > User Permissions")," and make sure you have everything selected:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Add permissions",src:n(12266).Z,width:"802",height:"430"})),(0,o.kt)("p",null,"This will give your user Administrator privileges."),(0,o.kt)("p",null,"To enforce two-factor authentication, edit the ",(0,o.kt)("strong",{parentName:"p"},"pve")," authentication realm\n(which you will find under ",(0,o.kt)("strong",{parentName:"p"},"Permissions > Realms"),") and select the desired TFA\nmethod."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Enabling TFA at the realm level applies to all users authenticating\nagainst that realm.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"TFA",src:n(31475).Z,width:"1280",height:"438"})),(0,o.kt)("p",null,"Next, log out of the Proxmox UI and log back in using the newly created user."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Login",src:n(27103).Z,width:"608",height:"278"})),(0,o.kt)("p",null,"After entering your username and password, Proxmox will prompt you for a second\nauthentication factor."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"TOTP",src:n(15113).Z,width:"770",height:"226"})),(0,o.kt)("p",null,"During the previous steps, a TOTP secret key was generated using the ",(0,o.kt)("inlineCode",{parentName:"p"},"oathkeygen"),"\ncommand. This key represents the shared secret between Proxmox and your two-factor\nauthentication application."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"dino-admin@stormy-dino:~# oathkeygen\n7QQ7FIM6SD5235WX\n")),(0,o.kt)("p",null,"To complete the setup, open your preferred 2FA application (such as Duo, Google\nAuthenticator, Authy, or similar) and create a new TOTP entry. When prompted,\nmanually enter the generated key as the application's secret key and give it a\nrecognizable name, for example \u201cProxmox\u201d."),(0,o.kt)("p",null,"Once the key is added, your 2FA application will begin generating 6-digit\nverification codes. Enter the current code when prompted by the Proxmox login\nscreen to complete authentication."),(0,o.kt)("h2",{id:"harden-ssh-access"},"Harden SSH Access"),(0,o.kt)("p",null,"SSH access to the Proxmox host should be locked down early, disabling\npassword-based SSH authentication and requiring SSH key-based authentication\nonly is a good starting point. In order to do so, make sure following lines in\nyour ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/ssh/sshd_config")," file are exactly like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"PasswordAuthentication no\nKbdInteractiveAuthentication no\nPubkeyAuthentication yes\n")),(0,o.kt)("p",null,"If it's not like this, make sure to change it and then restart ",(0,o.kt)("inlineCode",{parentName:"p"},"sshd"),".\nAdditionally, access to the host can be further restricted by minimizing direct\nroot usage and relying on controlled administrative access where appropriate."),(0,o.kt)("p",null,"These steps are standard Debian hardening practices and are fully supported on\nProxmox hosts. They significantly reduce the risk of brute-force attacks and\ncredential leaks."),(0,o.kt)("h2",{id:"apply-a-minimal-host-firewall"},"Apply a Minimal Host Firewall"),(0,o.kt)("p",null,"Proxmox includes a built-in firewall that can be enabled at the datacenter,\nnode, or VM level. At minimum, apply a simple host-level firewall policy that\nallows only required services, such as:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Proxmox web interface (TCP 8006)"),(0,o.kt)("li",{parentName:"ul"},"SSH (restricted to trusted IPs)"),(0,o.kt)("li",{parentName:"ul"},"Cluster or storage traffic as needed")),(0,o.kt)("p",null,"Blocking all other inbound traffic at the host level reduces unnecessary\nexposure without impacting normal Proxmox functionality. Proxmox supports\nfirewall rules at the Datacenter, Node, and Virtual Machine levels, so feel\nfree to apply whatever suits you the best. For example, if you set up a node\nfirewall via UI, you'll be able to see the configuration inside\n",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/pve/nodes/{your-node}/host.fw")," file. This is a simple example of what the\nfile can look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"dino-admin@stormy-dino:~# cat /etc/pve/nodes/stormy-dino/host.fw\n[OPTIONS]\nenable: 1\n\n[RULES]\nIN ACCEPT -source 11.22.33.44/32 -p tcp -dport 22 -log nolog # Allow SSH\nfrom admin IP\nIN ACCEPT -source 11.22.33.44/32 -p tcp -dport 8006 -log nolog # Allow Proxmox\nUI from admin IP\n")),(0,o.kt)("h2",{id:"keep-the-system-updated-and-lean"},"Keep the System Updated and Lean"),(0,o.kt)("p",null,"Proxmox is based on Debian, and keeping the underlying system up to date is an\nessential part of security. Regularly apply security updates for both Debian\nand Proxmox packages. Updates can be applied directly from the Proxmox web\ninterface or via standard Debian package management tools."),(0,o.kt)("p",null,"Remove unused services and packages from the host where possible. A lean system\nhas a smaller attack surface and is easier to monitor and maintain over time."),(0,o.kt)("h2",{id:"monitor-logs-and-backups"},"Monitor Logs and Backups"),(0,o.kt)("p",null,"Review system and authentication logs periodically for unexpected activity.\nProxmox provides clear logging for login attempts, task execution, and system\nevents, which makes early detection of issues easier. Proxmox makes this\nvisibility straightforward. Useful system information is available under\n",(0,o.kt)("strong",{parentName:"p"},"Node > System > System Log")," in the web interface. For deeper inspection,\nstandard Debian logs such as ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/log/auth.log")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"journalctl")," are also\navailable on the host."),(0,o.kt)("p",null,"Task history can also be useful as you can check lot of things, like updates,\nVM behaviors, any console view attempt and so on."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Task History",src:n(42169).Z,width:"2422",height:"1278"})),(0,o.kt)("p",null,"Enable backup verification and periodically validate that backups are\nrestorable. While this is often considered an operational task, it is also a\nsecurity measure, protecting against data loss caused by misconfiguration or\nmalicious actions."),(0,o.kt)("h2",{id:"final-thoughts"},"Final Thoughts"),(0,o.kt)("p",null,"Securing a Proxmox VE bare metal host does not require complex tooling or\ninvasive changes. By limiting management access, enforcing strong\nauthentication, applying a minimal firewall, and keeping the system updated,\nyou align with long-standing Proxmox community recommendations and official\nguidance. These small, well-tested steps provide a solid security baseline\nwhile keeping the platform flexible and easy to operate."))}p.isMDXComponent=!0},31475:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/proxmox-security-TFA-b86a98f5d9a21e13ed6d9df01f5e88bd.png"},15113:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/proxmox-security-TOTP-ad90a38579a242674f420c47d6cfcb11.png"},90597:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/proxmox-security-add-user-68e7e1eef5a6215cbd861e227a00470e.png"},27103:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/proxmox-security-login-2cbc228568942d0b6d2d8b24bcd41db8.png"},12266:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/proxmox-security-permissions-7d9cdba680121839edef2dd414cb75fd.png"},31494:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/proxmox-security-rules-17d09c65bf570c772eae165c55a036d4.png"},42169:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/proxmox-security-task-history-034ab54deb37c117c87bad7a6f31a417.png"}}]);