"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[673],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>m});var n=o(67294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var i=n.createContext({}),c=function(e){var t=n.useContext(i),o=t;return e&&(o="function"==typeof e?e(t):l(l({},t),e)),o},p=function(e){var t=c(e.components);return n.createElement(i.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(o),h=a,m=u["".concat(i,".").concat(h)]||u[h]||d[h]||r;return o?n.createElement(m,l(l({ref:t},p),{},{components:o})):n.createElement(m,l({ref:t},p))}));function m(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,l=new Array(r);l[0]=h;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[u]="string"==typeof e?e:a,l[1]=s;for(var c=2;c<r;c++)l[c]=o[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,o)}h.displayName="MDXCreateElement"},9941:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var n=o(87462),a=(o(67294),o(3905));const r={sidebar_position:3},l="Troubleshooting a Private Cloud's Ceph Cluster",s={unversionedId:"operators-manual/day-4/troubleshooting/ceph",id:"operators-manual/day-4/troubleshooting/ceph",title:"Troubleshooting a Private Cloud's Ceph Cluster",description:"Introduction",source:"@site/docs/operators-manual/day-4/troubleshooting/ceph.md",sourceDirName:"operators-manual/day-4/troubleshooting",slug:"/operators-manual/day-4/troubleshooting/ceph",permalink:"/docs/manuals/operators-manual/day-4/troubleshooting/ceph",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/operators-manual/day-4/troubleshooting/ceph.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"How to Redeploy OpenStack's RabbitMQ Cluster using Kolla Ansible",permalink:"/docs/manuals/operators-manual/day-4/troubleshooting/redeploy-rabbitmq"},next:{title:"Guidelines for Searching through OpenStack Logs",permalink:"/docs/manuals/operators-manual/day-4/troubleshooting/log-filtering"}},i={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Root Access to OpenStack Control Plane",id:"root-access-to-openstack-control-plane",level:3},{value:"Get Ceph&#39;s Status",id:"get-cephs-status",level:2},{value:"Ceph Log Files",id:"ceph-log-files",level:2},{value:"Common Issues",id:"common-issues",level:2},{value:"Clock Skew",id:"clock-skew",level:3},{value:"Confirm Ceph&#39;s Health",id:"confirm-cephs-health",level:4},{value:"Examine Chrony Logs",id:"examine-chrony-logs",level:4},{value:"Addressing Clock Skew",id:"addressing-clock-skew",level:4},{value:"References",id:"references",level:2}],p={toc:c};function u(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"troubleshooting-a-private-clouds-ceph-cluster"},"Troubleshooting a Private Cloud's Ceph Cluster"),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"In this guide, we explain how to get started troubleshooting issues with\nyour Private Cloud's Ceph cluster. A goal of this guide is to collect\ncommon troubleshooting scenarios and outline a method of addressing\nthem."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("h3",{id:"root-access-to-openstack-control-plane"},"Root Access to OpenStack Control Plane"),(0,a.kt)("p",null,"Root access to your cloud's control plane nodes is required."),(0,a.kt)("h2",{id:"get-cephs-status"},"Get Ceph's Status"),(0,a.kt)("p",null,"In most troubleshooting cases, you can get an overview of your Ceph\ncluster by checking its status. To check your Ceph cluster's status, use\n",(0,a.kt)("inlineCode",{parentName:"p"},"ceph status"),"."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# ceph status\n  cluster:\n    id:     34fa49b3-fff8-4702-8b17-4e8d873c845f\n    health: HEALTH_WARN\n            clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n            2 daemons have recently crashed\n\n  services:\n    mon: 3 daemons, quorum relaxed-flamingo,focused-capybara,lovely-ladybug (age 5d)\n    mgr: relaxed-flamingo(active, since 5d), standbys: focused-capybara, lovely-ladybug\n    osd: 4 osds: 4 up (since 5d), 4 in (since 13d)\n    rgw: 3 daemons active (focused-capybara.rgw0, lovely-ladybug.rgw0, relaxed-flamingo.rgw0)\n\n  task status:\n\n  data:\n    pools:   13 pools, 337 pgs\n    objects: 110.16k objects, 388 GiB\n    usage:   1.1 TiB used, 11 TiB / 12 TiB avail\n    pgs:     337 active+clean\n\n  io:\n    client:   381 KiB/s rd, 1.2 MiB/s wr, 444 op/s rd, 214 op/s wr\n")),(0,a.kt)("h2",{id:"ceph-log-files"},"Ceph Log Files"),(0,a.kt)("p",null,"Ceph's log files are stored in ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/log/ceph/")," within each control\nplane node."),(0,a.kt)("p",null,"For example, listed are all log files for host ",(0,a.kt)("inlineCode",{parentName:"p"},"focused-capybara"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# ls -1 /var/log/ceph/*.log\n/var/log/ceph/ceph.audit.log\n/var/log/ceph/ceph.log\n/var/log/ceph/ceph-mgr.focused-capybara.log\n/var/log/ceph/ceph-mon.focused-capybara.log\n/var/log/ceph/ceph-osd.1.log\n/var/log/ceph/ceph-rgw-focused-capybara.rgw0.log\n/var/log/ceph/ceph-volume.log\n")),(0,a.kt)("p",null,"A OpenMetal Ceph cluster is comprised of several services: Ceph's\nManager, Monitor, OSD, and RADOSGW"),(0,a.kt)("p",null,"Ceph has a primary log file, log files for each service, and additional\nlog files."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Primary Log File"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"/var/log/ceph/ceph.log")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Ceph Monitor Log File"),":\n",(0,a.kt)("inlineCode",{parentName:"li"},"/var/log/ceph/ceph-mon.focused-capybara.log")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Ceph RADOSGW Log File"),":\n",(0,a.kt)("inlineCode",{parentName:"li"},"/var/log/ceph/ceph-rgw-focused-capybara.rgw0.log"))),(0,a.kt)("p",null,"If you are unsure which Ceph service's log to look through, consider\nstarting with the primary log file, ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/log/ceph/ceph.log"),"."),(0,a.kt)("h2",{id:"common-issues"},"Common Issues"),(0,a.kt)("h3",{id:"clock-skew"},"Clock Skew"),(0,a.kt)("p",null,"Ceph has a number of health checks, including one for clock skew, called\n",(0,a.kt)("inlineCode",{parentName:"p"},"MON_CLOCK_SKEW"),". For more, see Ceph's ",(0,a.kt)("a",{parentName:"p",href:"https://docs.ceph.com/en/latest/rados/operations/health-checks/"},"Health\nChecks"),"\nguide and look for the text ",(0,a.kt)("strong",{parentName:"p"},"MON","_","CLOCK","_","SKEW"),". Ceph in our\nconfiguration uses ",(0,a.kt)("inlineCode",{parentName:"p"},"chronyd")," to sync each node's clock. Kolla Ansible is\nresponsible for installing and configuring ",(0,a.kt)("inlineCode",{parentName:"p"},"chronyd")," into a Docker\ncontainer for each Ceph Monitor node. To administer ",(0,a.kt)("inlineCode",{parentName:"p"},"chronyd")," you must\ndo so through Docker."),(0,a.kt)("h4",{id:"confirm-cephs-health"},"Confirm Ceph's Health"),(0,a.kt)("p",null,"To confirm the status of this health check, execute ",(0,a.kt)("inlineCode",{parentName:"p"},"ceph status")," and\nexamine the output."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cluster:\n  id:     34fa49b3-fff8-4702-8b17-4e8d873c845f\n  health: HEALTH_WARN\n          clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n[...output truncated...]\n")),(0,a.kt)("p",null,"Alternatively, execute ",(0,a.kt)("inlineCode",{parentName:"p"},"ceph health detail")," to only see the status of\nhealth checks."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"HEALTH_WARN clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n[WRN] MON_CLOCK_SKEW: clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n    mon.focused-capybara clock skew 0.663159s > max 0.05s (latency 0.000399254s)\n    mon.lovely-ladybug clock skew 0.368233s > max 0.05s (latency 0.000385143s)\n")),(0,a.kt)("h4",{id:"examine-chrony-logs"},"Examine Chrony Logs"),(0,a.kt)("p",null,"From here, you may want to examine the logs for each ",(0,a.kt)("inlineCode",{parentName:"p"},"chrony")," Docker\ninstance running."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker logs chrony\n")),(0,a.kt)("p",null,"Alternatively, consider viewing logs on the local file system for\n",(0,a.kt)("inlineCode",{parentName:"p"},"chrony")," via ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/log/kolla/chrony/"),"."),(0,a.kt)("h4",{id:"addressing-clock-skew"},"Addressing Clock Skew"),(0,a.kt)("p",null,"There may be a number of methods to addressing clock skew. In this\nexample, we outline addressing this issue by restarting ",(0,a.kt)("inlineCode",{parentName:"p"},"chrony")," for\neach node."),(0,a.kt)("p",null,"To address the ",(0,a.kt)("inlineCode",{parentName:"p"},"MON_CLOCK_SKEW")," for the example output in this section,\nthe Docker container ",(0,a.kt)("inlineCode",{parentName:"p"},"chrony")," was restarted for each node. For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# docker restart chrony\nchrony\n")),(0,a.kt)("p",null,"Next, perform the same Ceph health check as before to confirm the\nstatus. For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# ceph health detail\nHEALTH_OK\n")),(0,a.kt)("p",null,"If the clock skew issue is no longer present, you should see the status\nof ",(0,a.kt)("inlineCode",{parentName:"p"},"HEALTH_OK")," assuming there are no other issues with the Ceph cluster."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note","!")," -- Restarting ",(0,a.kt)("inlineCode",{parentName:"p"},"chrony")," may be a heavy handed approach to\naddressing the issue. Consider alternatively making using of ",(0,a.kt)("inlineCode",{parentName:"p"},"chronyc"),"'s\n",(0,a.kt)("inlineCode",{parentName:"p"},"tracking"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"sources"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"sourcestats")," subcommands to diagnose clock\nskew issues."),(0,a.kt)("h2",{id:"references"},"References"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Ceph's\n",(0,a.kt)("a",{parentName:"li",href:"https://docs.ceph.com/en/latest/rados/troubleshooting/index.html"},"Troubleshooting")),(0,a.kt)("li",{parentName:"ul"},"Ceph's ",(0,a.kt)("a",{parentName:"li",href:"https://docs.ceph.com/en/latest/rados/troubleshooting/troubleshooting-mon/"},"Troubleshooting\nMonitors"))))}u.isMDXComponent=!0}}]);