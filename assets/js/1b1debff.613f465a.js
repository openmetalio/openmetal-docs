"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[5528],{3905:(e,o,t)=>{t.d(o,{Zo:()=>p,kt:()=>m});var n=t(67294);function r(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}function a(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?a(Object(t),!0).forEach((function(o){r(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function s(e,o){if(null==e)return{};var t,n,r=function(e,o){if(null==e)return{};var t,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],o.indexOf(t)>=0||(r[t]=e[t]);return r}(e,o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],o.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),c=function(e){var o=n.useContext(i),t=o;return e&&(t="function"==typeof e?e(o):l(l({},o),e)),t},p=function(e){var o=c(e.components);return n.createElement(i.Provider,{value:o},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var o=e.children;return n.createElement(n.Fragment,{},o)}},h=n.forwardRef((function(e,o){var t=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(t),h=r,m=u["".concat(i,".").concat(h)]||u[h]||d[h]||a;return t?n.createElement(m,l(l({ref:o},p),{},{components:t})):n.createElement(m,l({ref:o},p))}));function m(e,o){var t=arguments,r=o&&o.mdxType;if("string"==typeof e||r){var a=t.length,l=new Array(a);l[0]=h;var s={};for(var i in o)hasOwnProperty.call(o,i)&&(s[i]=o[i]);s.originalType=e,s[u]="string"==typeof e?e:r,l[1]=s;for(var c=2;c<a;c++)l[c]=t[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},67756:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var n=t(87462),r=(t(67294),t(3905));const a={sidebar_position:3},l="Troubleshooting a Private Cloud's Ceph Cluster",s={unversionedId:"day-4/troubleshooting/ceph",id:"version-2.0/day-4/troubleshooting/ceph",title:"Troubleshooting a Private Cloud's Ceph Cluster",description:"Introduction",source:"@site/operators_versioned_docs/version-2.0/day-4/troubleshooting/ceph.md",sourceDirName:"day-4/troubleshooting",slug:"/day-4/troubleshooting/ceph",permalink:"/docs/manuals/operators-manual/operators_versioned_docs/version-2.0/day-4/troubleshooting/ceph",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/operators_versioned_docs/version-2.0/day-4/troubleshooting/ceph.md",tags:[],version:"2.0",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"operatorsSidebar",previous:{title:"How to Redeploy OpenStack's RabbitMQ Cluster using Kolla Ansible",permalink:"/docs/manuals/operators-manual/operators_versioned_docs/version-2.0/day-4/troubleshooting/redeploy-rabbitmq"},next:{title:"Guidelines for Searching through OpenStack Logs",permalink:"/docs/manuals/operators-manual/operators_versioned_docs/version-2.0/day-4/troubleshooting/log-filtering"}},i={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Root Access to OpenStack Control Plane",id:"root-access-to-openstack-control-plane",level:3},{value:"Get Ceph&#39;s Status",id:"get-cephs-status",level:2},{value:"Ceph Log Files",id:"ceph-log-files",level:2},{value:"Common Issues",id:"common-issues",level:2},{value:"Clock Skew",id:"clock-skew",level:3},{value:"Confirm Ceph&#39;s Health",id:"confirm-cephs-health",level:4},{value:"Examine Chrony Logs",id:"examine-chrony-logs",level:4},{value:"Addressing Clock Skew",id:"addressing-clock-skew",level:4},{value:"References",id:"references",level:2}],p={toc:c};function u(e){let{components:o,...t}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,t,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"troubleshooting-a-private-clouds-ceph-cluster"},"Troubleshooting a Private Cloud's Ceph Cluster"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In this guide, we explain how to get started troubleshooting issues with\nyour Private Cloud's Ceph cluster. A goal of this guide is to collect\ncommon troubleshooting scenarios and outline a method of addressing\nthem."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"root-access-to-openstack-control-plane"},"Root Access to OpenStack Control Plane"),(0,r.kt)("p",null,"Root access to your cloud's control plane nodes is required."),(0,r.kt)("h2",{id:"get-cephs-status"},"Get Ceph's Status"),(0,r.kt)("p",null,"In most troubleshooting cases, you can get an overview of your Ceph\ncluster by checking its status. To check your Ceph cluster's status, use\n",(0,r.kt)("inlineCode",{parentName:"p"},"ceph status"),"."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ceph status\n  cluster:\n    id:     34fa49b3-fff8-4702-8b17-4e8d873c845f\n    health: HEALTH_WARN\n            clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n            2 daemons have recently crashed\n\n  services:\n    mon: 3 daemons, quorum relaxed-flamingo,focused-capybara,lovely-ladybug (age 5d)\n    mgr: relaxed-flamingo(active, since 5d), standbys: focused-capybara, lovely-ladybug\n    osd: 4 osds: 4 up (since 5d), 4 in (since 13d)\n    rgw: 3 daemons active (focused-capybara.rgw0, lovely-ladybug.rgw0, relaxed-flamingo.rgw0)\n\n  task status:\n\n  data:\n    pools:   13 pools, 337 pgs\n    objects: 110.16k objects, 388 GiB\n    usage:   1.1 TiB used, 11 TiB / 12 TiB avail\n    pgs:     337 active+clean\n\n  io:\n    client:   381 KiB/s rd, 1.2 MiB/s wr, 444 op/s rd, 214 op/s wr\n")),(0,r.kt)("h2",{id:"ceph-log-files"},"Ceph Log Files"),(0,r.kt)("p",null,"Ceph's log files are stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/ceph/")," within each control\nplane node."),(0,r.kt)("p",null,"For example, listed are all log files for host ",(0,r.kt)("inlineCode",{parentName:"p"},"focused-capybara"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ls -1 /var/log/ceph/*.log\n/var/log/ceph/ceph.audit.log\n/var/log/ceph/ceph.log\n/var/log/ceph/ceph-mgr.focused-capybara.log\n/var/log/ceph/ceph-mon.focused-capybara.log\n/var/log/ceph/ceph-osd.1.log\n/var/log/ceph/ceph-rgw-focused-capybara.rgw0.log\n/var/log/ceph/ceph-volume.log\n")),(0,r.kt)("p",null,"A OpenMetal Ceph cluster is comprised of several services: Ceph's\nManager, Monitor, OSD, and RADOSGW"),(0,r.kt)("p",null,"Ceph has a primary log file, log files for each service, and additional\nlog files."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Primary Log File"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"/var/log/ceph/ceph.log")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Ceph Monitor Log File"),":\n",(0,r.kt)("inlineCode",{parentName:"li"},"/var/log/ceph/ceph-mon.focused-capybara.log")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Ceph RADOSGW Log File"),":\n",(0,r.kt)("inlineCode",{parentName:"li"},"/var/log/ceph/ceph-rgw-focused-capybara.rgw0.log"))),(0,r.kt)("p",null,"If you are unsure which Ceph service's log to look through, consider\nstarting with the primary log file, ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/ceph/ceph.log"),"."),(0,r.kt)("h2",{id:"common-issues"},"Common Issues"),(0,r.kt)("h3",{id:"clock-skew"},"Clock Skew"),(0,r.kt)("p",null,"Ceph has a number of health checks, including one for clock skew, called\n",(0,r.kt)("inlineCode",{parentName:"p"},"MON_CLOCK_SKEW"),". For more, see Ceph's ",(0,r.kt)("a",{parentName:"p",href:"https://docs.ceph.com/en/latest/rados/operations/health-checks/"},"Health\nChecks"),"\nguide and look for the text ",(0,r.kt)("strong",{parentName:"p"},"MON","_","CLOCK","_","SKEW"),". Ceph in our\nconfiguration uses ",(0,r.kt)("inlineCode",{parentName:"p"},"chronyd")," to sync each node's clock. Kolla Ansible is\nresponsible for installing and configuring ",(0,r.kt)("inlineCode",{parentName:"p"},"chronyd")," into a Docker\ncontainer for each Ceph Monitor node. To administer ",(0,r.kt)("inlineCode",{parentName:"p"},"chronyd")," you must\ndo so through Docker."),(0,r.kt)("h4",{id:"confirm-cephs-health"},"Confirm Ceph's Health"),(0,r.kt)("p",null,"To confirm the status of this health check, execute ",(0,r.kt)("inlineCode",{parentName:"p"},"ceph status")," and\nexamine the output."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cluster:\n  id:     34fa49b3-fff8-4702-8b17-4e8d873c845f\n  health: HEALTH_WARN\n          clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n[...output truncated...]\n")),(0,r.kt)("p",null,"Alternatively, execute ",(0,r.kt)("inlineCode",{parentName:"p"},"ceph health detail")," to only see the status of\nhealth checks."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"HEALTH_WARN clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n[WRN] MON_CLOCK_SKEW: clock skew detected on mon.focused-capybara, mon.lovely-ladybug\n    mon.focused-capybara clock skew 0.663159s > max 0.05s (latency 0.000399254s)\n    mon.lovely-ladybug clock skew 0.368233s > max 0.05s (latency 0.000385143s)\n")),(0,r.kt)("h4",{id:"examine-chrony-logs"},"Examine Chrony Logs"),(0,r.kt)("p",null,"From here, you may want to examine the logs for each ",(0,r.kt)("inlineCode",{parentName:"p"},"chrony")," Docker\ninstance running."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker logs chrony\n")),(0,r.kt)("p",null,"Alternatively, consider viewing logs on the local file system for\n",(0,r.kt)("inlineCode",{parentName:"p"},"chrony")," via ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/kolla/chrony/"),"."),(0,r.kt)("h4",{id:"addressing-clock-skew"},"Addressing Clock Skew"),(0,r.kt)("p",null,"There may be a number of methods to addressing clock skew. In this\nexample, we outline addressing this issue by restarting ",(0,r.kt)("inlineCode",{parentName:"p"},"chrony")," for\neach node."),(0,r.kt)("p",null,"To address the ",(0,r.kt)("inlineCode",{parentName:"p"},"MON_CLOCK_SKEW")," for the example output in this section,\nthe Docker container ",(0,r.kt)("inlineCode",{parentName:"p"},"chrony")," was restarted for each node. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# docker restart chrony\nchrony\n")),(0,r.kt)("p",null,"Next, perform the same Ceph health check as before to confirm the\nstatus. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ceph health detail\nHEALTH_OK\n")),(0,r.kt)("p",null,"If the clock skew issue is no longer present, you should see the status\nof ",(0,r.kt)("inlineCode",{parentName:"p"},"HEALTH_OK")," assuming there are no other issues with the Ceph cluster."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note","!")," -- Restarting ",(0,r.kt)("inlineCode",{parentName:"p"},"chrony")," may be a heavy handed approach to\naddressing the issue. Consider alternatively making using of ",(0,r.kt)("inlineCode",{parentName:"p"},"chronyc"),"'s\n",(0,r.kt)("inlineCode",{parentName:"p"},"tracking"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"sources"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"sourcestats")," subcommands to diagnose clock\nskew issues."),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ceph's\n",(0,r.kt)("a",{parentName:"li",href:"https://docs.ceph.com/en/latest/rados/troubleshooting/index.html"},"Troubleshooting")),(0,r.kt)("li",{parentName:"ul"},"Ceph's ",(0,r.kt)("a",{parentName:"li",href:"https://docs.ceph.com/en/latest/rados/troubleshooting/troubleshooting-mon/"},"Troubleshooting\nMonitors"))))}u.isMDXComponent=!0}}]);