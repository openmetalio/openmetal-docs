"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[8382],{3905:(e,n,o)=>{o.d(n,{Zo:()=>c,kt:()=>m});var t=o(67294);function a(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function i(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function r(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?i(Object(o),!0).forEach((function(n){a(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function l(e,n){if(null==e)return{};var o,t,a=function(e,n){if(null==e)return{};var o,t,a={},i=Object.keys(e);for(t=0;t<i.length;t++)o=i[t],n.indexOf(o)>=0||(a[o]=e[o]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)o=i[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=t.createContext({}),p=function(e){var n=t.useContext(s),o=n;return e&&(o="function"==typeof e?e(n):r(r({},n),e)),o},c=function(e){var n=p(e.components);return t.createElement(s.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},f=t.forwardRef((function(e,n){var o=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(o),f=a,m=u["".concat(s,".").concat(f)]||u[f]||d[f]||i;return o?t.createElement(m,r(r({ref:n},c),{},{components:o})):t.createElement(m,r({ref:n},c))}));function m(e,n){var o=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=o.length,r=new Array(i);r[0]=f;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[u]="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=o[p];return t.createElement.apply(null,r)}return t.createElement.apply(null,o)}f.displayName="MDXCreateElement"},34440:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var t=o(87462),a=(o(67294),o(3905));const i={sidebar_position:4},r="How to Copy and Restore OpenStack Service Configuration",l={unversionedId:"day-3/create-openstack-service-backups",id:"version-2.0/day-3/create-openstack-service-backups",title:"How to Copy and Restore OpenStack Service Configuration",description:"Introduction",source:"@site/operators_versioned_docs/version-2.0/day-3/create-openstack-service-backups.md",sourceDirName:"day-3",slug:"/day-3/create-openstack-service-backups",permalink:"/docs/manuals/operators-manual/operators_versioned_docs/version-2.0/day-3/create-openstack-service-backups",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/operators_versioned_docs/version-2.0/day-3/create-openstack-service-backups.md",tags:[],version:"2.0",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"operatorsSidebar",previous:{title:"Create and Restore Volume Backups",permalink:"/docs/manuals/operators-manual/operators_versioned_docs/version-2.0/day-3/create-volume-backups"},next:{title:"Backup and Restore OpenStack Service Databases",permalink:"/docs/manuals/operators-manual/operators_versioned_docs/version-2.0/day-3/backup-restore-openstack-databases"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Before Proceeding with this Guide",id:"before-proceeding-with-this-guide",level:2},{value:"Kolla Ansible and Cephadm",id:"kolla-ansible-and-cephadm",level:2},{value:"Prepare a Kolla Ansible Environment",id:"prepare-a-kolla-ansible-environment",level:3},{value:"Where are my Private Cloud&#39;s Configuration Files?",id:"where-are-my-private-clouds-configuration-files",level:3},{value:"Kolla Ansible Configuration Files",id:"kolla-ansible-configuration-files",level:4},{value:"Cephadm Configuration",id:"cephadm-configuration",level:4},{value:"Keep a Backup Copy a Private Cloud&#39;s Configuration Files",id:"keep-a-backup-copy-a-private-clouds-configuration-files",level:3},{value:"How to Restore a Private Cloud&#39;s Configuration Files",id:"how-to-restore-a-private-clouds-configuration-files",level:2},{value:"Example: Recover Neutron&#39;s Configuration File using Kolla Ansible",id:"example-recover-neutrons-configuration-file-using-kolla-ansible",level:3},{value:"Prerequisite: Prepare a Kolla Ansible Environment",id:"prerequisite-prepare-a-kolla-ansible-environment",level:4},{value:"Regenerate an OpenStack Service&#39;s Configuration File using Kolla Ansible",id:"regenerate-an-openstack-services-configuration-file-using-kolla-ansible",level:4}],c={toc:p};function u(e){let{components:n,...o}=e;return(0,a.kt)("wrapper",(0,t.Z)({},c,o,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"how-to-copy-and-restore-openstack-service-configuration"},"How to Copy and Restore OpenStack Service Configuration"),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Your OpenMetal private cloud is comprised of OpenStack services, which\nlike the applications and services you might deploy inside of it, should\nbe backed up on a regular interval so you can recover from catastrophic\nevents. In this guide, we explain how to copy your cloud's configuration\nfiles and OpenStack service databases as well as how to restore these\nitems."),(0,a.kt)("h2",{id:"before-proceeding-with-this-guide"},"Before Proceeding with this Guide"),(0,a.kt)("p",null,"This guide introduces potentially harmful commands and actions that\ncould cause the cloud to become inoperable or be in an unexpected state.\nRead commands carefully before executing them."),(0,a.kt)("h2",{id:"kolla-ansible-and-cephadm"},"Kolla Ansible and Cephadm"),(0,a.kt)("p",null,"Kolla Ansible is responsible for deploying a Private Cloud's OpenStack\nservices. Cephadm then handles the deployment of the cloud's Ceph\ncluster. These two systems deploy all OpenStack and Ceph services\nrequired for a Private Cloud, including their configurations."),(0,a.kt)("h3",{id:"prepare-a-kolla-ansible-environment"},"Prepare a Kolla Ansible Environment"),(0,a.kt)("p",null,"Before working with Kolla Ansible you must prepare an environment in your shell:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"../day-4/kolla-ansible/prepare-kolla-ansible"},"How to Prepare and Use Kolla Ansible"))),(0,a.kt)("h3",{id:"where-are-my-private-clouds-configuration-files"},"Where are my Private Cloud's Configuration Files?"),(0,a.kt)("p",null,"When a cloud finishes deploying, the Ansible configurations used to deploy the\ncloud are exported into each of the control plane nodes within the folders\n",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/kolla-ansible-cli")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kolla"),". The Ceph configuration is stored in\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/ceph/spec.yaml"),". This section explains where configuration files are\nlocated and their purpose."),(0,a.kt)("h4",{id:"kolla-ansible-configuration-files"},"Kolla Ansible Configuration Files"),(0,a.kt)("p",null,"The information in these files was used to deploy your Private Cloud's\ncore OpenStack services into Docker containers:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Inventory:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"/opt/kolla-ansible-cli/inventory.yml")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"/opt/kolla-ansible-cli/ansible/inventory/multinode")))),(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Main Configuration: ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/kolla/globals.yml"))),(0,a.kt)("h4",{id:"cephadm-configuration"},"Cephadm Configuration"),(0,a.kt)("p",null,"The information in this file was used to deploy your Private Cloud's\nCeph cluster:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Cephadm spec.yaml: ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/ceph/spec.yaml"))),(0,a.kt)("h3",{id:"keep-a-backup-copy-a-private-clouds-configuration-files"},"Keep a Backup Copy a Private Cloud's Configuration Files"),(0,a.kt)("p",null,"In case something unexpected happens to these files, you should keep copies of\nthem off site. To preserve the configuration of OpenStack services and Ceph,\ncopy the directories ",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/kolla-ansible-cli/"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kolla")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/ceph"),"\nsomewhere outside of the cloud, in a secure, private location. These folders\ncontain sensitive information about your cloud so the information within should\nonly be accessible to those you trust or yourself."),(0,a.kt)("h2",{id:"how-to-restore-a-private-clouds-configuration-files"},"How to Restore a Private Cloud's Configuration Files"),(0,a.kt)("p",null,"There are two primary ways a Private Cloud's configuration file can be restored:\nCopy a known good configuration file from an off site location or use Ansible.\nThis section explains how you can use Kolla Ansible to recover a Private Cloud's\nOpenStack configuration files."),(0,a.kt)("h3",{id:"example-recover-neutrons-configuration-file-using-kolla-ansible"},"Example: Recover Neutron's Configuration File using Kolla Ansible"),(0,a.kt)("p",null,"For example, consider an event where one of your control plane nodes\nloses its Neutron server configuration file. This section explains how\nto recover this configuration by using Kolla Ansible."),(0,a.kt)("h4",{id:"prerequisite-prepare-a-kolla-ansible-environment"},"Prerequisite: Prepare a Kolla Ansible Environment"),(0,a.kt)("p",null,"Before proceeding, a Kolla Ansible environment needs to be prepared. For\ninformation about preparing a Kolla Ansible environment, see\n",(0,a.kt)("a",{parentName:"p",href:"../day-4/kolla-ansible/prepare-kolla-ansible"},"How to Prepare and Use Kolla Ansible"),"\nOnce the environment is prepared, navigate back to this section."),(0,a.kt)("h4",{id:"regenerate-an-openstack-services-configuration-file-using-kolla-ansible"},"Regenerate an OpenStack Service's Configuration File using Kolla Ansible"),(0,a.kt)("p",null,"In this example, we outline restoring the Neutron server configuration\nfile for the control plane node ",(0,a.kt)("inlineCode",{parentName:"p"},"relaxed-flamingo"),"."),(0,a.kt)("p",null,"In the Kolla Ansible inventory file,\n",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/kolla-ansible-cli/inventory.yml"),", the following hosts are\ndefined as control plane nodes under the heading ",(0,a.kt)("inlineCode",{parentName:"p"},"[control]"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"[control]\nrelaxed-flamingo ansible_host=10.204.28.7\nfocused-capybara ansible_host=10.204.30.158\nlovely-ladybug ansible_host=10.204.25.253\n")),(0,a.kt)("p",null,"To restore the Neutron server configuration file for ",(0,a.kt)("inlineCode",{parentName:"p"},"relaxed-flamingo"),",\nfirst ensure you have ",(0,a.kt)("a",{parentName:"p",href:"../day-4/kolla-ansible/prepare-kolla-ansible"},"prepared a Kolla Ansible environment")),(0,a.kt)("p",null,"Next, use Kolla Ansible's ",(0,a.kt)("inlineCode",{parentName:"p"},"reconfigure")," function, targeting only the\nNeutron service by using the flag ",(0,a.kt)("inlineCode",{parentName:"p"},"--tags neutron")," and limit the run to\nthe host ",(0,a.kt)("inlineCode",{parentName:"p"},"relaxed-flamingo")," by specifying the flag ",(0,a.kt)("inlineCode",{parentName:"p"},"--limit control[0]"),"."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kolla-ansible \\\n    -i /opt/kolla-ansible-cli/inventory.yml -i /opt/kolla-ansible-cli/ansible/inventory/multinode \\\n    reconfigure \\\n    --tags neutron \\\n    --limit control[0]\n")))}u.isMDXComponent=!0}}]);