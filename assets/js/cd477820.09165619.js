"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[2320],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var l=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,l,a=function(e,n){if(null==e)return{};var t,l,a={},o=Object.keys(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=l.createContext({}),p=function(e){var n=l.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return l.createElement(s.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},k=l.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),d=p(t),k=a,m=d["".concat(s,".").concat(k)]||d[k]||c[k]||o;return t?l.createElement(m,i(i({ref:n},u),{},{components:t})):l.createElement(m,i({ref:n},u))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=k;var r={};for(var s in n)hasOwnProperty.call(n,s)&&(r[s]=n[s]);r.originalType=e,r[d]="string"==typeof e?e:a,i[1]=r;for(var p=2;p<o;p++)i[p]=t[p];return l.createElement.apply(null,i)}return l.createElement.apply(null,t)}k.displayName="MDXCreateElement"},34026:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var l=t(87462),a=(t(67294),t(3905));const o={sidebar_position:1},i="How to Prepare and Use Kolla Ansible",r={unversionedId:"operators-manual/day-4/kolla-ansible/prepare-kolla-ansible",id:"operators-manual/day-4/kolla-ansible/prepare-kolla-ansible",title:"How to Prepare and Use Kolla Ansible",description:"Introduction",source:"@site/docs/operators-manual/day-4/kolla-ansible/prepare-kolla-ansible.md",sourceDirName:"operators-manual/day-4/kolla-ansible",slug:"/operators-manual/day-4/kolla-ansible/prepare-kolla-ansible",permalink:"/docs/manuals/operators-manual/day-4/kolla-ansible/prepare-kolla-ansible",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/operators-manual/day-4/kolla-ansible/prepare-kolla-ansible.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"OpenStack Disaster Planning, Testing, and Recovery",permalink:"/docs/manuals/operators-manual/day-3/disaster-recovery"},next:{title:"How to Enable TLS for OpenStack using Kolla Ansible",permalink:"/docs/manuals/operators-manual/day-4/kolla-ansible/enable-tls"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Before Proceeding",id:"before-proceeding",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Using Kolla Ansible",id:"using-kolla-ansible",level:2},{value:"Add SSH key for Kolla Ansible",id:"add-ssh-key-for-kolla-ansible",level:3},{value:"Prepare Kolla Ansible Quick Start",id:"prepare-kolla-ansible-quick-start",level:3},{value:"General Usage",id:"general-usage",level:3},{value:"Prepare Kolla Ansible",id:"prepare-kolla-ansible",level:3},{value:"Kolla Ansible Configuration Files",id:"kolla-ansible-configuration-files",level:3},{value:"Missing Inventory",id:"missing-inventory",level:4},{value:"Before Making Changes",id:"before-making-changes",level:4},{value:"Prepare Kolla Ansible Environment",id:"prepare-kolla-ansible-environment",level:3},{value:"<strong>Step 1</strong> - Prepare environment",id:"step-1---prepare-environment",level:4},{value:"<strong>Step 2</strong> -- Prepare Python virtual environment",id:"step-2----prepare-python-virtual-environment",level:4},{value:"<strong>Step 3</strong> -- Update pip",id:"step-3----update-pip",level:4},{value:"<strong>Step 4</strong> -- Install Kolla Ansible",id:"step-4----install-kolla-ansible",level:4},{value:"<strong>Step 5</strong> -- Install Ansible Galaxy dependencies",id:"step-5----install-ansible-galaxy-dependencies",level:4},{value:"<strong>Step 6</strong> -- Kolla Ansible is Ready for Use",id:"step-6----kolla-ansible-is-ready-for-use",level:4},{value:"References",id:"references",level:2}],u={toc:p};function d(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,l.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"how-to-prepare-and-use-kolla-ansible"},"How to Prepare and Use Kolla Ansible"),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Our Private Cloud Core deployments provide workload orchestration\nthrough the use of ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/openstack/kolla-ansible"},"Kolla\nAnsible")," which deploys\nOpenStack services and infrastructure components in Docker containers.\nShould you want to make a change to an OpenStack service's\nconfiguration, add a new OpenStack service, or even repair your\nOpenStack cluster, you can do so using Kolla Ansible. In this guide, we\nexplain how to prepare a Kolla Ansible environment, from which\nconfiguration changes can be made."),(0,a.kt)("h2",{id:"before-proceeding"},"Before Proceeding"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WARNING","!")," -- Our current deployment system deploys a Private Cloud\nwith a known working state. Should you deviate from this state by\nadjusting your cloud's OpenStack configuration you can no longer safely\nuse the functions in OpenMetal Central to add nodes to your cloud or add\nIP blocks. Should you use these functions, any custom configurations\nwill be reverted. We are working on rolling out a new deployment system\nallowing custom cloud configurations. We can still help you modify your\ncloud, but must do so manually. Please reach out to your Account Manager\nshould this apply to you."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Root access to your cloud's control plane nodes is required."),(0,a.kt)("li",{parentName:"ul"},"Experience using ",(0,a.kt)("a",{parentName:"li",href:"https://www.ansible.com/"},"Ansible"),".")),(0,a.kt)("h2",{id:"using-kolla-ansible"},"Using Kolla Ansible"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Caution","!")," Ensure the node from which you are working contains the\ndirectory ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kolla/config"),'. This directory exists in the control plane nodes\nand is used to provide our custom configuration to OpenStack services. Control\nplane nodes are labeled as "Cloud Core" in the Assets page of your cloud in\nOpenMetal Central.'),(0,a.kt)("h3",{id:"add-ssh-key-for-kolla-ansible"},"Add SSH key for Kolla Ansible"),(0,a.kt)("p",null,"You must add an SSH public key to your cloud's nodes. This public key can be added\nusing OpenMetal Central under ",(0,a.kt)("strong",{parentName:"p"},"Settings -> Add SSH Key"),"."),(0,a.kt)("p",null,"Create an Ansible deployment SSH keypair with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'ssh-keygen -t ed25519 -C "kolla-ansible"\n')),(0,a.kt)("h3",{id:"prepare-kolla-ansible-quick-start"},"Prepare Kolla Ansible Quick Start"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cd /opt/kolla-ansible-cli\npython3 -m venv .venv\nsource .venv/bin/activate\npip install --upgrade pip\npip install -r requirements.txt\nkolla-ansible install-deps\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Inventory: ",(0,a.kt)("inlineCode",{parentName:"li"},"/opt/kolla-ansible-cli/inventory.yml")),(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Multinode Inventory: ",(0,a.kt)("inlineCode",{parentName:"li"},"/opt/kolla-ansible-cli/ansible/inventory/multinode")),(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Main Configuration: ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/kolla/globals.yml"))),(0,a.kt)("h3",{id:"general-usage"},"General Usage"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kolla-ansible -i inventory.yml -i ansible/inventory/multinode <command>\n")),(0,a.kt)("p",null,"For a full list of available commands, see ",(0,a.kt)("a",{parentName:"p",href:"https://docs.openstack.org/kolla-ansible/latest/user/operating-kolla.html#kolla-ansible-cli"},"Kolla Ansible CLI"),"."),(0,a.kt)("h3",{id:"prepare-kolla-ansible"},"Prepare Kolla Ansible"),(0,a.kt)("p",null,"In this section, we explain the steps needed to create an environment\nfrom which Kolla Ansible can be executed. The steps in this section\nshould be performed from the node in your cloud that contains the path\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kolla/config"),". This directory exists on a single node and is used\nto provide our custom configuration to OpenStack services."),(0,a.kt)("h3",{id:"kolla-ansible-configuration-files"},"Kolla Ansible Configuration Files"),(0,a.kt)("p",null,"First, we introduce you to the files required for adjusting Kolla\nAnsible's configuration. These files are used when preparing Kolla\nAnsible."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Inventory: ",(0,a.kt)("inlineCode",{parentName:"li"},"/opt/kolla-ansible-cli/inventory.yml")),(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Multinode Inventory: ",(0,a.kt)("inlineCode",{parentName:"li"},"/opt/kolla-ansible-cli/ansible/inventory/multinode")),(0,a.kt)("li",{parentName:"ul"},"Kolla Ansible Main Configuration: ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/kolla/globals.yml"))),(0,a.kt)("p",null,"Both inventory files must be passed when using Kolla Ansible.\n",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/kolla-ansible-cli/inventory.yml")," contains your cloud's specific hosts\nwhereas ",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/kolla-ansible-cli/ansible/inventory/multinode")," groups the hosts as\nrequired by Kolla Ansible."),(0,a.kt)("p",null,"Double check the hosts specified in ",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/kolla-ansible-cli/inventory.yml"),"\nmatch the hosts listed in the Assets page of your cloud in OpenMetal Central."),(0,a.kt)("h4",{id:"missing-inventory"},"Missing Inventory"),(0,a.kt)("p",null,"Should you not find the inventory files in your cloud as specified in the\nprevious step, your cloud may be running an older release. Ideally your cloud\nshould be updated to our latest release, so reach out to us to help facilate\nthis."),(0,a.kt)("h4",{id:"before-making-changes"},"Before Making Changes"),(0,a.kt)("p",null,"Before any changes are made to the Kolla Ansible configuration, the\nfollowing variables in ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")," should not be modified,\notherwise they will be overwritten:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"api_interface\ncluster_interface\ndns_interface\ndocker_registry_insecure\nkolla_enable_tls_external\nkolla_external_fqdn\nkolla_external_vip_address\nkolla_internal_vip_address\nmigration_interface\nnetwork_interface\nneutron_external_interface\nopenstack_region_name\nstorage_interface\ntunnel_interface\n")),(0,a.kt)("p",null,"For more information, see the section titled ",(0,a.kt)("a",{parentName:"p",href:"#before-proceeding"},"Before\nProceeding")," at the top of this guide."),(0,a.kt)("h3",{id:"prepare-kolla-ansible-environment"},"Prepare Kolla Ansible Environment"),(0,a.kt)("h4",{id:"step-1---prepare-environment"},(0,a.kt)("strong",{parentName:"h4"},"Step 1")," - Prepare environment"),(0,a.kt)("p",null,"First ensure the node you are logged into over SSH contains the\ndirectory ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kolla/config"),'. This directory exists in the control plane nodes\nand is used to provide our custom configuration to OpenStack services. Control\nplane nodes are labeled as "Cloud Core" in the Assets page of your cloud in\nOpenMetal Central.'),(0,a.kt)("p",null,"Next, navigate to the folder ",(0,a.kt)("inlineCode",{parentName:"p"},"/opt/kolla-ansible-cli")," which contains required\nKolla Ansible configuration:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cd /opt/kolla-ansible-cli\n")),(0,a.kt)("h4",{id:"step-2----prepare-python-virtual-environment"},(0,a.kt)("strong",{parentName:"h4"},"Step 2")," -- Prepare Python virtual environment"),(0,a.kt)("p",null,"Create a Python virtual environment and activate it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cd /opt/kolla-ansible\npython3 -m venv .venv\nsource .venv/bin/activate\n")),(0,a.kt)("h4",{id:"step-3----update-pip"},(0,a.kt)("strong",{parentName:"h4"},"Step 3")," -- Update pip"),(0,a.kt)("p",null,"Update the virtual environment's ",(0,a.kt)("inlineCode",{parentName:"p"},"pip")," to the latest version, otherwise\npackages may not install as expected."),(0,a.kt)("p",null,"Update ",(0,a.kt)("inlineCode",{parentName:"p"},"pip")," using:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pip install --upgrade pip\n")),(0,a.kt)("h4",{id:"step-4----install-kolla-ansible"},(0,a.kt)("strong",{parentName:"h4"},"Step 4")," -- Install Kolla Ansible"),(0,a.kt)("p",null,"With the virtual environment prepared, we can now install Kolla Ansible\nand Ansible using ",(0,a.kt)("inlineCode",{parentName:"p"},"pip"),"."),(0,a.kt)("p",null,"Install Kolla Ansible and its dependencies:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pip install -r requirements.txt\n")),(0,a.kt)("p",null,"Should ",(0,a.kt)("inlineCode",{parentName:"p"},"requirements.txt")," not exist, you can ask us to sync that file to your\ncloud."),(0,a.kt)("p",null,"For our latest deployments running OpenStack 2023.2, ",(0,a.kt)("inlineCode",{parentName:"p"},"requirements.txt")," should contain:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ansible-core==2.15.*\nkolla-ansible==17.3.*\n")),(0,a.kt)("h4",{id:"step-5----install-ansible-galaxy-dependencies"},(0,a.kt)("strong",{parentName:"h4"},"Step 5")," -- Install Ansible Galaxy dependencies"),(0,a.kt)("p",null,"Install Ansible Galaxy dependencies using:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kolla-ansible install-deps\n")),(0,a.kt)("h4",{id:"step-6----kolla-ansible-is-ready-for-use"},(0,a.kt)("strong",{parentName:"h4"},"Step 6")," -- Kolla Ansible is Ready for Use"),(0,a.kt)("p",null,"At this step, you have everything prepared to use Kolla Ansible. Before\nproceeding, familiarize yourself with the available Kolla Ansible\ncommands by running ",(0,a.kt)("inlineCode",{parentName:"p"},"kolla-ansible --help"),". There are a number of\nfunctions possible, including maintenance tasks or making configuration\nchanges to your Private Cloud."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Caution","!")," -- Kolla Ansible's configuration is set through the file\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")," where some variables should not be changed. See\nthe section titled ",(0,a.kt)("a",{parentName:"p",href:"prepare-kolla-ansible#before-making-changes"},"Before Making\nChanges"),"\nat the top of this guide for more information."),(0,a.kt)("p",null,"An example configuration change made at this step is to enable TLS for\nHorizon. Enabling TLS falls outside the scope of this guide. For\ninstruction on how to do so, see ",(0,a.kt)("a",{parentName:"p",href:"enable-tls"},"How to Enable TLS for\nOpenStack"),"."),(0,a.kt)("p",null,"For complete documentation regarding available Kolla Ansible commands,\nsee ",(0,a.kt)("a",{parentName:"p",href:"https://docs.openstack.org/kolla-ansible/latest/user/operating-kolla.html"},"Operating\nKolla"),"."),(0,a.kt)("h2",{id:"references"},"References"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://docs.openstack.org/kolla-ansible/latest/"},"OpenStack Kolla Ansible\ndocumentation")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://docs.openstack.org/kolla-ansible/latest/user/quickstart.html"},"Kolla Ansible Quick\nStart"))))}d.isMDXComponent=!0}}]);