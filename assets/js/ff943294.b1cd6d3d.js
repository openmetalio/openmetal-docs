"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[5411],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>h});var a=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=c(t),m=l,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||r;return t?a.createElement(h,i(i({ref:n},p),{},{components:t})):a.createElement(h,i({ref:n},p))}));function h(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,i=new Array(r);i[0]=m;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[u]="string"==typeof e?e:l,i[1]=o;for(var c=2;c<r;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},24863:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=t(87462),l=(t(67294),t(3905));const r={description:"How to setup Severalnines CCX on OpenStack in an OpenMetal Cloud.",sidebar_name:"Severalnines CCX on OpenStack",slug:"/tutorials/severalnines-ccx-on-openstack"},i="Severalnines CCX on OpenStack",o={unversionedId:"tutorials/several-nines",id:"tutorials/several-nines",title:"Severalnines CCX on OpenStack",description:"How to setup Severalnines CCX on OpenStack in an OpenMetal Cloud.",source:"@site/docs/tutorials/several-nines.md",sourceDirName:"tutorials",slug:"/tutorials/severalnines-ccx-on-openstack",permalink:"/docs/manuals/tutorials/severalnines-ccx-on-openstack",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/tutorials/several-nines.md",tags:[],version:"current",frontMatter:{description:"How to setup Severalnines CCX on OpenStack in an OpenMetal Cloud.",sidebar_name:"Severalnines CCX on OpenStack",slug:"/tutorials/severalnines-ccx-on-openstack"},sidebar:"tutorialSidebar",previous:{title:"Recover an Instance Using Horizon",permalink:"/docs/manuals/tutorials/recoveraninstance"},next:{title:"Creating OpenStack VM Images with ISO",permalink:"/docs/manuals/tutorials/understanding-iso-images"}},s={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1 - Create a new VM",id:"step-1---create-a-new-vm",level:2},{value:"Step 2 - Setup requirements",id:"step-2---setup-requirements",level:2},{value:"Step 3 - OpenStack CLI Client",id:"step-3---openstack-cli-client",level:2},{value:"Step 4 - Run the Severalnines CCX yaml generator script",id:"step-4---run-the-severalnines-ccx-yaml-generator-script",level:2},{value:"Clone the Severalnines CCX repository",id:"clone-the-severalnines-ccx-repository",level:3},{value:"Gather OpenStack information",id:"gather-openstack-information",level:3},{value:"Optional - Create Object Store container",id:"optional---create-object-store-container",level:3},{value:"Create a namespace for the CCX installation",id:"create-a-namespace-for-the-ccx-installation",level:3},{value:"Run the yaml generator script",id:"run-the-yaml-generator-script",level:3},{value:"Step 5 - Depoly CCX",id:"step-5---depoly-ccx",level:2},{value:"Add the Severalnines Helm repository",id:"add-the-severalnines-helm-repository",level:3},{value:"Install the Severalnines Helm chart",id:"install-the-severalnines-helm-chart",level:3},{value:"Step 6 - Verify CCX",id:"step-6---verify-ccx",level:2},{value:"Fetch the CCX URL",id:"fetch-the-ccx-url",level:3},{value:"Access the CCX URL in your browser",id:"access-the-ccx-url-in-your-browser",level:3},{value:"Register for a new account",id:"register-for-a-new-account",level:3},{value:"Deploy a datastore",id:"deploy-a-datastore",level:3},{value:"Conclusion",id:"conclusion",level:2}],p={toc:c};function u(e){let{components:n,...r}=e;return(0,l.kt)("wrapper",(0,a.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"severalnines-ccx-on-openstack"},"Severalnines CCX on OpenStack"),(0,l.kt)("h2",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"Severalnines provides database automation solutions, enabling high-availability\nand scalable database management for hybrid environments. Their key product,\nCCX, supports various databases like PostgreSQL, MongoDB, and MySQL, offering\nfeatures like failover, backups, monitoring, and alerting."),(0,l.kt)("p",null,"For more information on Severalnines, visit ",(0,l.kt)("a",{parentName:"p",href:"https://severalnines.com/"},"https://severalnines.com/"),"."),(0,l.kt)("hr",null),(0,l.kt)("p",null,"In this tutorial, we will show you how to set up Severalnines\nCCX V2 on OpenStack in an OpenMetal Cloud. We used this guide from Severalnines\nas a reference: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/severalnines/ccx-admin-guide/wiki/Installation-V2"},"https://github.com/severalnines/ccx-admin-guide/wiki/Installation-V2"),"."),(0,l.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"OpenStack"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"You can deploy an OpenStack cloud on OpenMetal. For more\ninformation, refer to ",(0,l.kt)("a",{parentName:"li",href:"https://openmetal.io/products/on-demand-openstack-cloud/"},"OpenStack on OpenMetal Cloud"),"."),(0,l.kt)("li",{parentName:"ul"},"We recommend setting up TLS on your OpenStack environment, otherwise you may\nrun into issues connecting to the OpenStack API."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Kubernetes Cluster"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"In this guide, we deployed a Kubernetes cluster using ",(0,l.kt)("a",{parentName:"li",href:"../kubernetes-guides/deploying-a-kubespray-cluster-to-openstack-using-terraform"},"Kubespray"),"."),(0,l.kt)("li",{parentName:"ul"},"Ensure can access to the Kubernetes cluster API from the node you're\nusing to install CCX."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Severalnines CCX License"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"You will need a Severalnines CCX license to install the product. Contact\nSeveralnines ",(0,l.kt)("a",{parentName:"li",href:"https://severalnines.com/contact/"},"https://severalnines.com/contact/")," for more information.")))),(0,l.kt)("h2",{id:"step-1---create-a-new-vm"},"Step 1 - Create a new VM"),(0,l.kt)("p",null,"This installation process requires several components to be installed.\nWe will use a new VM to initiate the installation process,\nbut you can also use your local device."),(0,l.kt)("p",null,"Note this node will need to have access to the Kubernetes cluster API."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Log in to the OpenStack Horizon dashboard."),(0,l.kt)("li",{parentName:"ol"},"Click on the ",(0,l.kt)("inlineCode",{parentName:"li"},"Compute")," tab."),(0,l.kt)("li",{parentName:"ol"},"Click on ",(0,l.kt)("inlineCode",{parentName:"li"},"Instances")," and then click on ",(0,l.kt)("inlineCode",{parentName:"li"},"Launch Instance"),"."),(0,l.kt)("li",{parentName:"ol"},"Fill in the required details like ",(0,l.kt)("inlineCode",{parentName:"li"},"Instance Name"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"Flavor"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"Image"),",\n",(0,l.kt)("inlineCode",{parentName:"li"},"Network"),", and ",(0,l.kt)("inlineCode",{parentName:"li"},"Security Group"),". Select\n",(0,l.kt)("inlineCode",{parentName:"li"},"Ubuntu 22.04 (Jammy)")," for the image name."),(0,l.kt)("li",{parentName:"ol"},"Click on ",(0,l.kt)("inlineCode",{parentName:"li"},"Launch Instance"),"."),(0,l.kt)("li",{parentName:"ol"},"Once the instance is launched, SSH into the instance.")),(0,l.kt)("p",null,"If you need help launching an instance, refer to the\n",(0,l.kt)("a",{parentName:"p",href:"../../manuals/users-manual/how-to-create-an-instance/"},"Creating an Instance")," tutorial."),(0,l.kt)("h2",{id:"step-2---setup-requirements"},"Step 2 - Setup requirements"),(0,l.kt)("p",null,"Installing CCX is done by installing two\nHelm charts. Severalnines provides a convenient script that creates the ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," file\nto configure your deployment. Let's install the dependencies for this process."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Install ",(0,l.kt)("inlineCode",{parentName:"li"},"jq"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt install jq\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Install Helm 3")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\nchmod 700 get_helm.sh\n./get_helm.sh\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Install yq ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/mikefarah/yq"},"https://github.com/mikefarah/yq"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O /usr/bin/yq\nsudo chmod +x /usr/bin/yq\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Install kubectl")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"\nsudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Save the kube config file from your Kubernetes cluster to the VM and test\nthe connection.")),(0,l.kt)("h2",{id:"step-3---openstack-cli-client"},"Step 3 - OpenStack CLI Client"),(0,l.kt)("p",null,"We'll be using the OpenStack client to fetch the required information\nfor the CCX ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," generator script."),(0,l.kt)("p",null,"Install dependencies for OpenStack client"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install python3-pip\nsudo apt install python3.10-venv\n")),(0,l.kt)("p",null,"Please follow the steps in the ",(0,l.kt)("a",{parentName:"p",href:"../../manuals/users-manual/openstackclient"},"OpenStack CLI"),"\nguide."),(0,l.kt)("h2",{id:"step-4---run-the-severalnines-ccx-yaml-generator-script"},"Step 4 - Run the Severalnines CCX yaml generator script"),(0,l.kt)("h3",{id:"clone-the-severalnines-ccx-repository"},"Clone the Severalnines CCX repository"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/severalnines/helm-charts\ncd helm-charts\n")),(0,l.kt)("h3",{id:"gather-openstack-information"},"Gather OpenStack information"),(0,l.kt)("p",null,"   The script will need some information from your OpenStack environment.\nRun the following commands and save the response for later."),(0,l.kt)("p",null,"Images"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"openstack image list\n")),(0,l.kt)("p",null,"Networks"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"openstack network list\n")),(0,l.kt)("p",null,"Security Groups"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"openstack security group list\n")),(0,l.kt)("h3",{id:"optional---create-object-store-container"},"Optional - Create Object Store container"),(0,l.kt)("p",null,"The script will ask for s3 access key and secret key. You'll\nneed to provide this if you plan on enabling backups."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"openstack container create ccx-backups\n")),(0,l.kt)("h3",{id:"create-a-namespace-for-the-ccx-installation"},"Create a namespace for the CCX installation"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create namespace ccx\nkubectl config set-context --current --namespace=ccx\n")),(0,l.kt)("h3",{id:"run-the-yaml-generator-script"},"Run the yaml generator script"),(0,l.kt)("p",null,"There are many prompts in the script. The script generates a ",(0,l.kt)("inlineCode",{parentName:"p"},"yaml")," file\nand saves your credentials for OpenStack and the Object Store in a secret.\nWe've provided the output of our script as a reference."),(0,l.kt)("p",null,"When prompted for ccx-deps proceed with ",(0,l.kt)("inlineCode",{parentName:"p"},"y"),", it will install the dependencies\nfor you. For the purposes of this tutorial, we did not install External DNS."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"charts/ccx/scripts/ccx-yaml-gen.sh\n")),(0,l.kt)("p",null,"Note: The s3 section is optional. If you don't have an object store, you can\nskip this section."),(0,l.kt)("p",null,"Note: You will need your CCX license at this point."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'# Output: values.yaml\nccx:\n  cloudSecrets:\n    - openstack-creds\n    - openstack-s3\n  services:\n    deployer:\n      config:\n        openstack_vendors:\n          openmetal:\n            auth_url: https://openstack.url:5000\n            network_api_version: NetworkNeutron\n            compute_api_microversion: "2.79"\n            floating_ip_api_version: FloatingIPV3\n            project_id: fbf2c7b0637549af975a25dc9d243e7a\n            floating_network_id: c000423b-72a7-42c7-a6b3-89c2faa105fa\n            network_id: c000423b-72a7-42c7-a6b3-89c2faa105fa\n            max_jobs: 5\n            retries: 5\n            regions:\n              IAD3:\n                image_id: 7332b0b3-7c48-4a8f-a33b-324985c1f93a\n                secgrp_name: default\n            s3:\n              endpoint: https://openstack.url:6780/swift/v1/AUTH_hash\n              access_key: hash\n              secret_key: api_key\n  config:\n    clouds:\n      - code: openmetal\n        name: openmetal\n        regions:\n          - code: IAD3\n            display_code: IAD3\n            name: IAD3\n            country_code: US\n            continent_code: NA\n            city: VA\n            availability_zones:\n              - code: iad3\n                name: iad3\n        network_types:\n          - name: Public\n            code: Public\n            info: All instances will be deployed with public IPs. Access to the public IPs is controlled by a firewall\n            in_vpc: false\n        instance_types:\n          - code: gen2.medium\n            name: gen2.medium\n            type: gen2.medium\n            cpu: 4\n            ram: 4096\n            disk_size: 100\n        volume_types:\n          - code: 669a5ea4-a3b0-4147-8df5-3a092ad9161a\n            name: 669a5ea4-a3b0-4147-8df5-3a092ad9161a\n            info: Storage is directly attached to the server\n            has_iops: false\n            size:\n              min: 80\n              max: 8000\n              default: 80\n  userDomain: ccx.domain.io\nsessionDomain: domain.io\nccxFQDN: ccx.domain.io\nccFQDN: cc.domain.io\nstorageClassName: cinder-default\ncmon:\n  license: YourLicense\n  password: YourChosenPassword\n---\n')),(0,l.kt)("h2",{id:"step-5---depoly-ccx"},"Step 5 - Depoly CCX"),(0,l.kt)("h3",{id:"add-the-severalnines-helm-repository"},"Add the Severalnines Helm repository"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo add s9s https://severalnines.github.io/helm-charts/\nhelm repo update\n")),(0,l.kt)("h3",{id:"install-the-severalnines-helm-chart"},"Install the Severalnines Helm chart"),(0,l.kt)("p",null,"Note: Ensure to check all pods, jobs are running without any errors."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm install ccx s9s/ccx --wait --debug --values values.yaml\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods -n ccx\n")),(0,l.kt)("h2",{id:"step-6---verify-ccx"},"Step 6 - Verify CCX"),(0,l.kt)("h3",{id:"fetch-the-ccx-url"},"Fetch the CCX URL"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get ingress ccx-ingress -n ccx\n")),(0,l.kt)("h3",{id:"access-the-ccx-url-in-your-browser"},"Access the CCX URL in your browser"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"https://ccx.domain.io/\n")),(0,l.kt)("h3",{id:"register-for-a-new-account"},"Register for a new account"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Register for an account",src:t(15306).Z,title:"Several Nines Sign up",width:"1718",height:"1326"})),(0,l.kt)("h3",{id:"deploy-a-datastore"},"Deploy a datastore"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Deploy a datastore",src:t(13686).Z,title:"Deploy a datastore",width:"1718",height:"1304"})),(0,l.kt)("h2",{id:"conclusion"},"Conclusion"),(0,l.kt)("p",null,"You have successfully installed Severalnines CCX on OpenStack in an OpenMetal Cloud!\nFor more information and troubleshooting, refer to the ",(0,l.kt)("a",{parentName:"p",href:"https://severalnines.com/docs/"},"Severalnines documentation"),"."))}u.isMDXComponent=!0},13686:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/datastore-acd60c89e75b1bdf674ea6e6789e85d8.png"},15306:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/signup-80b6673563253c6076698b46eb9c320f.png"}}]);