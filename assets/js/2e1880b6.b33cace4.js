"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[1191],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=i,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||r;return n?a.createElement(g,o(o({ref:t},c),{},{components:n})):a.createElement(g,o({ref:t},c))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},32467:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(87462),i=(n(67294),n(3905));const r={},o="Create a Site-to-Site VPN Connection with Endpoint Groups in Horizon",s={unversionedId:"tutorials/create-site-to-site-vpn-in-horizon",id:"tutorials/create-site-to-site-vpn-in-horizon",title:"Create a Site-to-Site VPN Connection with Endpoint Groups in Horizon",description:"Author: Ramon Grullon",source:"@site/docs/tutorials/create-site-to-site-vpn-in-horizon.md",sourceDirName:"tutorials",slug:"/tutorials/create-site-to-site-vpn-in-horizon",permalink:"/docs/manuals/tutorials/create-site-to-site-vpn-in-horizon",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/tutorials/create-site-to-site-vpn-in-horizon.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How to Handle a Ceph Cluster Going Read-Only Due to Full OSDs",permalink:"/docs/manuals/tutorials/ceph-ro-guide"},next:{title:"Configuring Time-Based One-Time Password (TOTP) on OpenStack",permalink:"/docs/manuals/tutorials/enable-totp-openstack"}},l={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Notable Changes",id:"notable-changes",level:2},{value:"VPN Recommended Settings",id:"vpn-recommended-settings",level:2},{value:"Overview",id:"overview",level:2},{value:"Step One: West Network Setup",id:"step-one-west-network-setup",level:3},{value:"Step Two: Create an IKE and IPSec Policy",id:"step-two-create-an-ike-and-ipsec-policy",level:3},{value:"Step Three: Create a VPN Service",id:"step-three-create-a-vpn-service",level:3},{value:"Step Four: Create Endpoint Groups",id:"step-four-create-endpoint-groups",level:3},{value:"Step Six: Create VPN Site Connections",id:"step-six-create-vpn-site-connections",level:3},{value:"Step Seven: Test Site-to-Site Connection",id:"step-seven-test-site-to-site-connection",level:3},{value:"References",id:"references",level:2}],c={toc:p};function d(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"create-a-site-to-site-vpn-connection-with-endpoint-groups-in-horizon"},"Create a Site-to-Site VPN Connection with Endpoint Groups in Horizon"),(0,i.kt)("p",null,"Author: Ramon Grullon"),(0,i.kt)("p",null,"Neutron provides Site-to-Site IPsec VPN through VPN as a Service (VPNaaS).\nIPsec policies and connections are configured within OpenStack meaning\nno dedicated virtual machines are required to use this service."),(0,i.kt)("p",null,"For CLI procedure please use - ",(0,i.kt)("a",{parentName:"p",href:"https://openmetal.io/docs/manuals/tutorials/create-site-to-site-vpn"},"CLI VPN Site-to-Site")),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Familiarity with OpenStackClient")),(0,i.kt)("h2",{id:"notable-changes"},"Notable Changes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"In Bobcat, the VPN driver changed from Libreswan to strongSwan")),(0,i.kt)("h2",{id:"vpn-recommended-settings"},"VPN Recommended Settings"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Operation"),(0,i.kt)("th",{parentName:"tr",align:null},"Security Option"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Pre-shared Key"),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Protocol"),(0,i.kt)("td",{parentName:"tr",align:null},"IKEv2")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IKE Phase 1 Encryption Algorithm"),(0,i.kt)("td",{parentName:"tr",align:null},"AES-256")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IKE Phase 1 Authorization Algorithm"),(0,i.kt)("td",{parentName:"tr",align:null},"SHA512")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IKE Phase 1 PFS(Perfect Forward Secrecy)"),(0,i.kt)("td",{parentName:"tr",align:null},"Enabled")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IKE Phase 1 DHGRP(Diffie-Hellman Groups)"),(0,i.kt)("td",{parentName:"tr",align:null},"14")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IKE Phase 1 Lifetime units(seconds) for keys"),(0,i.kt)("td",{parentName:"tr",align:null},"3600")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IKE Phase 1 Negotiation Mode"),(0,i.kt)("td",{parentName:"tr",align:null},"Main")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IPSec - IKE Phase 2 Authorization algorithm"),(0,i.kt)("td",{parentName:"tr",align:null},"SHA512")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IPSec - IKE Phase 2 PFS(Perfect Forward Secrecy)"),(0,i.kt)("td",{parentName:"tr",align:null},"Enabled")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IPSec - IKE Phase 2 DHGRP(Diffie-Hellman Groups)"),(0,i.kt)("td",{parentName:"tr",align:null},"14")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IPSec - IKE Phase 2 IPSec Transform Protocol"),(0,i.kt)("td",{parentName:"tr",align:null},"ESP")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IPSec - IKE Phase 2 Lifetime units(seconds) for keys"),(0,i.kt)("td",{parentName:"tr",align:null},"3600")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"IPSec Encapsulation Mode"),(0,i.kt)("td",{parentName:"tr",align:null},"Tunnel")))),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"This article explains how to configure a VPN Site-to-Site connection using OpenStack.\nThis allows you to configure communication between private networks across different\nlocations."),(0,i.kt)("p",null,"We will be using 2 OpenStack clouds which will be referred to as East Cloud and\nWest Cloud. Each cloud will have 1 router attached to subnets utilizing 1 VPN service."),(0,i.kt)("p",null,"In this guide, we'll be creating West-Cloud as our local VPN and all steps\nshould be duplicated for East-Cloud"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"network diagram",src:n(69417).Z,title:"Network Diagram",width:"706",height:"519"})),(0,i.kt)("h3",{id:"step-one-west-network-setup"},"Step One: West Network Setup"),(0,i.kt)("p",null,"Create all prerequisite network components. In this example we used"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"Router- West-Router\nNetwork - west-primary & west-secondary\nSubnet - west-primary-subnet & west-secondary-subnet\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://openmetal.io/docs/manuals/users-manual/network-ip-traffic"},"Networking in OpenStack"))),(0,i.kt)("p",null,"Associate both subnets created"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"west associate subnet",src:n(24346).Z,title:"West Associate Subnet Creation",width:"1135",height:"421"})),(0,i.kt)("h3",{id:"step-two-create-an-ike-and-ipsec-policy"},"Step Two: Create an IKE and IPSec Policy"),(0,i.kt)("p",null,"An IKE and IPSec policy will need to be created. It is recommended that you set\nexplicit parameters to provide higher security than the defaults. In our example\nwe are setting these on two OpenStack clusters, but the settings will be similar\non third party VPN tools. The goal is to configure both ends with the same IKE\nand IPSec Policy settings."),(0,i.kt)("p",null,"Go to VPN - IKE Policies - Add IKE Policy"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"ike policy button",src:n(74802).Z,title:"IKE Policy Button",width:"1137",height:"613"})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"ike policy configs",src:n(25643).Z,title:"IKE Policy Configs",width:"726",height:"794"})),(0,i.kt)("p",null,"Go to VPN - IPsec Policies - Add IPsec Policy"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"ipsec policy button",src:n(32500).Z,title:"IPSec Policy Button",width:"1138",height:"607"})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"ipsec policy configs",src:n(19670).Z,title:"IPSec Policy Configs",width:"724",height:"792"})),(0,i.kt)("h3",{id:"step-three-create-a-vpn-service"},"Step Three: Create a VPN Service"),(0,i.kt)("p",null,"Now create a VPN service for both sites. You will want to take note of the\nexternal IP addresses assigned to each."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: The VPN services are configured without a subnet defined. This allows\nyou flexibility to configure multiple local subnets in a local endpoint group\nper IPSec site connection or multiple site connections with different local\nsubnets.\nEach remote endpoint group requiring its own site2site connection.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"west vpn button",src:n(98049).Z,title:"West VPN Button",width:"1135",height:"612"})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"west vpn configs",src:n(16114).Z,title:"West VPN Configs",width:"725",height:"476"})),(0,i.kt)("p",null," ",(0,i.kt)("strong",{parentName:"p"},"Take note as the external IP may be different from the router.")),(0,i.kt)("h3",{id:"step-four-create-endpoint-groups"},"Step Four: Create Endpoint Groups"),(0,i.kt)("p",null,"The Endpoint Group is used to configure multiple local and remote subnets in a\nVPN service."),(0,i.kt)("p",null,"Create west ",(0,i.kt)("strong",{parentName:"p"},"local")," endpoint groups"),(0,i.kt)("p",null,"Local endpoint groups define subnets given by name or UUID. The site west\nlocal endpoint contains ",(0,i.kt)("inlineCode",{parentName:"p"},"west-localendpointgroup"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"west localendpoint",src:n(27874).Z,title:"West Local Endpoint Group",width:"720",height:"487"})),(0,i.kt)("p",null,"Create west ",(0,i.kt)("strong",{parentName:"p"},"peer")," endpoint groups"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"    Peer endpoint groups are CIDRs. The site west peer endpoint group will\n    contain the peer subnet CIDR. In this case that's the site `east subnet`.\n")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"west remoteendpoint1",src:n(16214).Z,title:"West Remote Endpoint Group1",width:"722",height:"438"})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"west remoteendpoint2",src:n(71153).Z,title:"West Remote Endpoint Group2",width:"722",height:"437"})),(0,i.kt)("h3",{id:"step-six-create-vpn-site-connections"},"Step Six: Create VPN Site Connections"),(0,i.kt)("p",null,"Create west site connection"),(0,i.kt)("p",null,"Create a site connection (",(0,i.kt)("inlineCode",{parentName:"p"},"west-ipsec1"),") from site west (VPN service\n",(0,i.kt)("inlineCode",{parentName:"p"},"west-vpnservice"),") to site east (peer IP address ",(0,i.kt)("inlineCode",{parentName:"p"},"173.231.254.174"),") defining\nthe local (",(0,i.kt)("inlineCode",{parentName:"p"},"west-localendpointgroup"),") and peer (",(0,i.kt)("inlineCode",{parentName:"p"},"west-remoteendpointgroup1"),")\nendpoint groups."),(0,i.kt)("p",null,"Repeat this process for each individual remote endpoint group.\n(A remote endpoint group can only have 1 subnet per)"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"west ipsec1",src:n(67708).Z,title:"West IPSec1",width:"728",height:"927"})),(0,i.kt)("h3",{id:"step-seven-test-site-to-site-connection"},"Step Seven: Test Site-to-Site Connection"),(0,i.kt)("p",null,"Create instances connected to both subnets on west and both subnets on east.\nConfirm they can communicate via ICMP echo requests to local IPs."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"ping test 1",src:n(23848).Z,title:"Ping Test 1",width:"566",height:"192"})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"ping test 2",src:n(72056).Z,title:"Ping Test 2",width:"550",height:"162"})),(0,i.kt)("h2",{id:"references"},"References"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://https://docs.openstack.org/neutron/latest/admin/vpnaas-scenario.html"},"https://https://docs.openstack.org/neutron/latest/admin/vpnaas-scenario.html"))))}d.isMDXComponent=!0},74802:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ike_policy_button-cda37eb26244d486d76a14bd9215fdda.png"},25643:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ike_policy_configs-dc87f98f2bd4d5ee311ee2f7645b4cde.png"},32500:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ipsec_policy_button-4fef9ea0b0ac63a941371a7e8d50f656.png"},19670:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ipsec_policy_configs-8f290566130a85c6d2ad45087f46131e.png"},69417:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/network_diagram-722044b168ce6e4750f019839ecaded9.png"},23848:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pingtest1-2b114f74d2dc663f166d5d266ba5db7d.png"},72056:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pingtest2-5834b1c96fa99b7caf3ba3e298cdf40c.png"},24346:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/west_associate_subnet-82ee3c79669a9843022ca94d44d0d9f2.png"},67708:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/west_ipsec1-dd7c3ddbf4850ec08d333e5c43a2d9fe.png"},27874:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/west_localendpoint-3d69961f861be92b86645cac415539cb.png"},16214:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/west_remoteendpoint1-45674722b3ced9cc2f7cace4778609b9.png"},71153:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/west_remoteendpoint2-fbe78f544fbff59b64e7039ed649f7ac.png"},98049:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/west_vpn_service_button-373650403a2322a0cb091e1de6aa26fe.png"},16114:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/west_vpn_service_configs-b53492ceb854a83cb6525677666ddfca.png"}}]);