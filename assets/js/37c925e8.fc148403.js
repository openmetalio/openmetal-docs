"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[7717],{3905:(e,n,o)=>{o.d(n,{Zo:()=>u,kt:()=>m});var t=o(67294);function i(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function a(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function l(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?a(Object(o),!0).forEach((function(n){i(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function r(e,n){if(null==e)return{};var o,t,i=function(e,n){if(null==e)return{};var o,t,i={},a=Object.keys(e);for(t=0;t<a.length;t++)o=a[t],n.indexOf(o)>=0||(i[o]=e[o]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)o=a[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var s=t.createContext({}),p=function(e){var n=t.useContext(s),o=n;return e&&(o="function"==typeof e?e(n):l(l({},n),e)),o},u=function(e){var n=p(e.components);return t.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},f=t.forwardRef((function(e,n){var o=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),c=p(o),f=i,m=c["".concat(s,".").concat(f)]||c[f]||d[f]||a;return o?t.createElement(m,l(l({ref:n},u),{},{components:o})):t.createElement(m,l({ref:n},u))}));function m(e,n){var o=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=o.length,l=new Array(a);l[0]=f;var r={};for(var s in n)hasOwnProperty.call(n,s)&&(r[s]=n[s]);r.originalType=e,r[c]="string"==typeof e?e:i,l[1]=r;for(var p=2;p<a;p++)l[p]=o[p];return t.createElement.apply(null,l)}return t.createElement.apply(null,o)}f.displayName="MDXCreateElement"},14264:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>p});var t=o(87462),i=(o(67294),o(3905));const a={sidebar_position:4},l="How to Copy and Restore OpenStack Service Configuration",r={unversionedId:"operators-manual/day-3/create-openstack-service-backups",id:"operators-manual/day-3/create-openstack-service-backups",title:"How to Copy and Restore OpenStack Service Configuration",description:"Introduction",source:"@site/docs/operators-manual/day-3/create-openstack-service-backups.md",sourceDirName:"operators-manual/day-3",slug:"/operators-manual/day-3/create-openstack-service-backups",permalink:"/docs/manuals/operators-manual/day-3/create-openstack-service-backups",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/operators-manual/day-3/create-openstack-service-backups.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Create and Restore Volume Backups",permalink:"/docs/manuals/operators-manual/day-3/create-volume-backups"},next:{title:"Backup and Restore OpenStack Service Databases",permalink:"/docs/manuals/operators-manual/day-3/backup-restore-openstack-databases"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Before Proceeding with this Guide",id:"before-proceeding-with-this-guide",level:2},{value:"Kolla Ansible and Ceph Ansible",id:"kolla-ansible-and-ceph-ansible",level:2},{value:"Prepare Kolla Ansible and Ceph Ansible Environment",id:"prepare-kolla-ansible-and-ceph-ansible-environment",level:3},{value:"Where are my Private Cloud&#39;s Configuration Files?",id:"where-are-my-private-clouds-configuration-files",level:3},{value:"Kolla Ansible Configuration Files",id:"kolla-ansible-configuration-files",level:4},{value:"Ceph Ansible Configuration Files",id:"ceph-ansible-configuration-files",level:4},{value:"FM-Deploy Configuration File",id:"fm-deploy-configuration-file",level:4},{value:"Network Ansible Configuration File",id:"network-ansible-configuration-file",level:4},{value:"Keep a Backup Copy a Private Cloud&#39;s Configuration Files",id:"keep-a-backup-copy-a-private-clouds-configuration-files",level:3},{value:"How to Restore a Private Cloud&#39;s Configuration Files",id:"how-to-restore-a-private-clouds-configuration-files",level:2},{value:"Example: Recover Neutron&#39;s Configuration File using Kolla Ansible",id:"example-recover-neutrons-configuration-file-using-kolla-ansible",level:3},{value:"Prerequisite: Prepare a Kolla Ansible Environment",id:"prerequisite-prepare-a-kolla-ansible-environment",level:4},{value:"Regenerate an OpenStack Service&#39;s Configuration File using Kolla Ansible",id:"regenerate-an-openstack-services-configuration-file-using-kolla-ansible",level:4}],u={toc:p};function c(e){let{components:n,...o}=e;return(0,i.kt)("wrapper",(0,t.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-copy-and-restore-openstack-service-configuration"},"How to Copy and Restore OpenStack Service Configuration"),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"Your OpenMetal private cloud is comprised of OpenStack services, which\nlike the applications and services you might deploy inside of it, should\nbe backed up on a regular interval so you can recover from catastrophic\nevents. In this guide, we explain how to copy your cloud's configuration\nfiles and OpenStack service databases as well as how to restore these\nitems."),(0,i.kt)("h2",{id:"before-proceeding-with-this-guide"},"Before Proceeding with this Guide"),(0,i.kt)("p",null,"This guide introduces potentially harmful commands and actions that\ncould cause the cloud to become inoperable or be in an unexpected state.\nRead commands carefully before executing them."),(0,i.kt)("h2",{id:"kolla-ansible-and-ceph-ansible"},"Kolla Ansible and Ceph Ansible"),(0,i.kt)("p",null,"Kolla Ansible is responsible for deploying a Private Cloud's OpenStack\nservices. Ceph Ansible then handles deployment of the cloud's Ceph\ncluster. These two systems deploy all OpenStack and Ceph services\nrequired for a Private Cloud, including their configurations."),(0,i.kt)("h3",{id:"prepare-kolla-ansible-and-ceph-ansible-environment"},"Prepare Kolla Ansible and Ceph Ansible Environment"),(0,i.kt)("p",null,"Before working with either Kolla Ansible or Ceph Ansible, you must\nprepare an environment in your shell:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"../day-4/kolla-ansible/prepare-kolla-ansible"},"How to Prepare and Use Kolla Ansible")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"../day-4/ceph-ansible/prepare-ceph-ansible"},"How to Prepare and Use Ceph Ansible"))),(0,i.kt)("h3",{id:"where-are-my-private-clouds-configuration-files"},"Where are my Private Cloud's Configuration Files?"),(0,i.kt)("admonition",{title:"New Clouds",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"On clouds provisioned ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"after")," Dec 2022")," you will need to open a\n",(0,i.kt)("a",{parentName:"p",href:"/docs/manuals/operators-manual/day-1/intro-to-openmetal-private-cloud#how-to-submit-a-support-ticket"},"support ticket"),"\nto have the configuration saved to your nodes.")),(0,i.kt)("p",null,"When a cloud finishes deploying, the Ansible configurations used to\ndeploy the cloud are exported into each of the control plane nodes\nwithin the folders ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla"),". This section\nexplains where configuration files are located and their purpose."),(0,i.kt)("h4",{id:"kolla-ansible-configuration-files"},"Kolla Ansible Configuration Files"),(0,i.kt)("p",null,"The information in these files was used to deploy your Private Cloud's\ncore OpenStack services into Docker containers:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Kolla Ansible Inventory: ",(0,i.kt)("inlineCode",{parentName:"li"},"/etc/fm-deploy/kolla-ansible-inventory")),(0,i.kt)("li",{parentName:"ul"},"Kolla Ansible Main Configuration: ",(0,i.kt)("inlineCode",{parentName:"li"},"/etc/kolla/globals.yml"))),(0,i.kt)("h4",{id:"ceph-ansible-configuration-files"},"Ceph Ansible Configuration Files"),(0,i.kt)("p",null,"The information in these files was used to deploy your Private Cloud's\nCeph cluster:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Ceph Ansible Inventory: ",(0,i.kt)("inlineCode",{parentName:"li"},"/etc/fm-deploy/ceph-inventory.yml")),(0,i.kt)("li",{parentName:"ul"},"Ceph Ansible Main Configuration: ",(0,i.kt)("inlineCode",{parentName:"li"},"/etc/fm-deploy/ceph-vars.yml"))),(0,i.kt)("h4",{id:"fm-deploy-configuration-file"},"FM-Deploy Configuration File"),(0,i.kt)("p",null,"FM-Deploy is a part of the system used to deploy your Private Cloud.\nInformation about this deployment system is provided for the sake of\ncompletely explaining the configuration files found within\n",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"FM-Deploy Main Configuration: ",(0,i.kt)("inlineCode",{parentName:"li"},"/etc/fm-deploy/config.yml"))),(0,i.kt)("h4",{id:"network-ansible-configuration-file"},"Network Ansible Configuration File"),(0,i.kt)("p",null,"The following defines the initial networking configuration for your\nPrivate Cloud. This file was used upon initial cloud deployment."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Inventory: ",(0,i.kt)("inlineCode",{parentName:"li"},"/etc/fm-deploy/network-inventory.yml"))),(0,i.kt)("h3",{id:"keep-a-backup-copy-a-private-clouds-configuration-files"},"Keep a Backup Copy a Private Cloud's Configuration Files"),(0,i.kt)("p",null,"In case something unexpected happens to these files, you should keep\ncopies of them off site. To preserve the configuration of OpenStack\nservices and Ceph, copy the directories ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/kolla"),"\nand ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/ceph")," somewhere outside of the cloud, in a secure, private\nlocation. These folders contain sensitive information about your cloud\nso the information within should only be accessible to those you trust\nor yourself."),(0,i.kt)("h2",{id:"how-to-restore-a-private-clouds-configuration-files"},"How to Restore a Private Cloud's Configuration Files"),(0,i.kt)("p",null,"There are two primary ways a Private Cloud's configuration file can be\nrestored: Copy a known good configuration file from an off site location\nor use Ansible. This section explains how you can use Kolla Ansible and\nCeph Ansible to recover a Private Cloud's configuration files."),(0,i.kt)("h3",{id:"example-recover-neutrons-configuration-file-using-kolla-ansible"},"Example: Recover Neutron's Configuration File using Kolla Ansible"),(0,i.kt)("p",null,"For example, consider an event where one of your control plane nodes\nloses its Neutron server configuration file. This section explains how\nto recover this configuration by using Kolla Ansible."),(0,i.kt)("h4",{id:"prerequisite-prepare-a-kolla-ansible-environment"},"Prerequisite: Prepare a Kolla Ansible Environment"),(0,i.kt)("p",null,"Before proceeding, a Kolla Ansible environment needs to be prepared. For\ninformation about preparing a Kolla Ansible environment, see\n",(0,i.kt)("a",{parentName:"p",href:"../day-4/kolla-ansible/prepare-kolla-ansible"},"How to Prepare and Use Kolla Ansible"),"\nOnce the environment is prepared, navigate back to this section."),(0,i.kt)("h4",{id:"regenerate-an-openstack-services-configuration-file-using-kolla-ansible"},"Regenerate an OpenStack Service's Configuration File using Kolla Ansible"),(0,i.kt)("p",null,"In this example, we outline restoring the Neutron server configuration\nfile for the control plane node ",(0,i.kt)("inlineCode",{parentName:"p"},"relaxed-flamingo"),"."),(0,i.kt)("p",null,"In the Kolla Ansible inventory file,\n",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy/kolla-ansible-inventory"),", the following hosts are\ndefined as control plane nodes under the heading ",(0,i.kt)("inlineCode",{parentName:"p"},"[control]"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[control]\nrelaxed-flamingo ansible_host=10.204.28.7\nfocused-capybara ansible_host=10.204.30.158\nlovely-ladybug ansible_host=10.204.25.253\n")),(0,i.kt)("p",null,"To restore the Neutron server configuration file for ",(0,i.kt)("inlineCode",{parentName:"p"},"relaxed-flamingo"),",\nfirst ensure you have ",(0,i.kt)("a",{parentName:"p",href:"../day-4/kolla-ansible/prepare-kolla-ansible"},"prepared a Kolla Ansible environment")),(0,i.kt)("p",null,"Next, use Kolla Ansible's ",(0,i.kt)("inlineCode",{parentName:"p"},"reconfigure")," function, targeting only the\nNeutron service by using the flag ",(0,i.kt)("inlineCode",{parentName:"p"},"--tags neutron")," and limit the run to\nthe host ",(0,i.kt)("inlineCode",{parentName:"p"},"relaxed-flamingo")," by specifying the flag ",(0,i.kt)("inlineCode",{parentName:"p"},"--limit control[0]"),"."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kolla-ansible \\\n    -i /etc/fm-deploy/kolla-ansible-inventory \\\n    reconfigure \\\n    --tags neutron \\\n    --limit control[0]\n")))}c.isMDXComponent=!0}}]);