"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[3975],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(f,i(i({ref:t},c),{},{components:n})):a.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},49024:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const o={},i="Configuring Time-Based One-Time Password (TOTP) on OpenStack",l={unversionedId:"tutorials/enable-totp-openstack",id:"tutorials/enable-totp-openstack",title:"Configuring Time-Based One-Time Password (TOTP) on OpenStack",description:"Author: Ramon Grullon",source:"@site/docs/tutorials/enable-totp-openstack.md",sourceDirName:"tutorials",slug:"/tutorials/enable-totp-openstack",permalink:"/docs/manuals/tutorials/enable-totp-openstack",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/tutorials/enable-totp-openstack.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Create a Site-to-Site VPN Connection with Endpoint Groups in Horizon",permalink:"/docs/manuals/tutorials/create-site-to-site-vpn-in-horizon"},next:{title:"Adding TRIM support to OpenStack Glance images",permalink:"/docs/manuals/tutorials/glance-trim-support"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create and Configure a TOTP Credential",id:"create-and-configure-a-totp-credential",level:3},{value:"Configure credentials and MFA rules for user",id:"configure-credentials-and-mfa-rules-for-user",level:3},{value:"Set Up TOTP",id:"set-up-totp",level:3},{value:"References",id:"references",level:2}],c={toc:p};function u(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"configuring-time-based-one-time-password-totp-on-openstack"},"Configuring Time-Based One-Time Password (TOTP) on OpenStack"),(0,r.kt)("p",null,"Author: Ramon Grullon"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Horizon added time-based one-time password (TOTP) authentication support,\nleveraging the already existing two factor authentication from Keystone.\nNow, if a user activates TOTP on Keystone, it gets activated on Horizon too."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A working OpenStack 2023.2 environment deployed using kolla-ansible."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.openstack.org/blog/new-in-openstack-bobcat-horizon-team-introduces-time-based-one-time-password-totp-authentication-support/"},"Keystone and Horizon reconfigured with TOTP enabled")),(0,r.kt)("li",{parentName:"ul"},"Admin access to the OpenStack dashboard and CLI."),(0,r.kt)("li",{parentName:"ul"},"Access to the kolla-ansible configuration files.")),(0,r.kt)("h3",{id:"create-and-configure-a-totp-credential"},"Create and Configure a TOTP Credential"),(0,r.kt)("p",null,"On one of your control nodes with OpenStack CLI configured:"),(0,r.kt)("p",null,"TOTP uses a base32 encoded string for the secret. The secret must be at least\n128 bits (16 bytes). The following bash code can be used to generate a TOTP secret:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo "iam16characters." | base32 | tr -d "="\n')),(0,r.kt)("p",null,"Example output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"GEZDGNBVGY3TQOJQGEZDGNBVGY\n\n")),(0,r.kt)("h3",{id:"configure-credentials-and-mfa-rules-for-user"},"Configure credentials and MFA rules for user"),(0,r.kt)("p",null,"Create and configure a user to utilize TOTP"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openstack user create --project admin --domain default --project-domain default --password-prompt --enable-multi-factor-auth --multi-factor-auth-rule password,totp mfa-member\n\nopenstack role add --user mfa-member --project admin member\n\nopenstack credential create --type totp mfa-member GEZDGNBVGY3TQOJQGEZDGNBVGY\n\n")),(0,r.kt)("h3",{id:"set-up-totp"},"Set Up TOTP"),(0,r.kt)("p",null,"This typically involves scanning a QR code with a TOTP app like Google Authenticator.\nOn a device install Google Authenticator and inside the app click on\n\u2018Set up account\u2019 and then click on \u2018Enter provided key\u2019. In the input fields\nenter account name and secret."),(0,r.kt)("p",null,"To quickly verify your configuration you can use ",(0,r.kt)("a",{parentName:"p",href:"https://totp.app"},"https://totp.app")," and enter your\nsecret to get your code."),(0,r.kt)("p",null,"Verify TOTP Authentication"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log out of the OpenStack dashboard.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Attempt to log back in. After entering your password, you should be prompted to\nenter your TOTP code.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enter TOTP Code:"))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"totp",src:n(69613).Z,width:"462",height:"332"})),(0,r.kt)("p",null,"Open your TOTP app and enter the current code to complete the login process."),(0,r.kt)("p",null,"By following these steps, you should have successfully enabled TOTP\nauthentication in OpenStack 2023.2 using kolla-ansible, allowing users to\nenhance the security of their accounts with TOTP through the Horizon dashboard."),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.openstack.org/keystone/latest/admin/auth-totp.html"},"https://docs.openstack.org/keystone/latest/admin/auth-totp.html")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=JEniPHp1l74"},"https://www.youtube.com/watch?v=JEniPHp1l74"))))}u.isMDXComponent=!0},69613:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/totp-login-e2a29523c1eabee63b690c90e382fd83.png"}}]);