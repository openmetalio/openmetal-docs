"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[6222],{3905:(e,t,i)=>{i.d(t,{Zo:()=>c,kt:()=>g});var a=i(67294);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var l=a.createContext({}),p=function(e){var t=a.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var i=e.components,n=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(i),m=n,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||r;return i?a.createElement(g,o(o({ref:t},c),{},{components:i})):a.createElement(g,o({ref:t},c))}));function g(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=i.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:n,o[1]=s;for(var p=2;p<r;p++)o[p]=i[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,i)}m.displayName="MDXCreateElement"},86810:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=i(87462),n=(i(67294),i(3905));const r={},o="Adding TRIM support to OpenStack Glance images",s={unversionedId:"tutorials/glance-trim-support",id:"tutorials/glance-trim-support",title:"Adding TRIM support to OpenStack Glance images",description:"What is TRIM Support?",source:"@site/docs/tutorials/glance-trim-support.md",sourceDirName:"tutorials",slug:"/tutorials/glance-trim-support",permalink:"/docs/manuals/tutorials/glance-trim-support",draft:!1,editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/tutorials/glance-trim-support.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Create a Site-to-Site VPN Connection with Endpoint Groups in Horizon",permalink:"/docs/manuals/tutorials/create-site-to-site-vpn-in-horizon"},next:{title:"Tutorials",permalink:"/docs/manuals/tutorials/"}},l={},p=[{value:"What is TRIM Support?",id:"what-is-trim-support",level:2},{value:"Enable TRIM in VMs using <code>fstrim</code>",id:"enable-trim-in-vms-using-fstrim",level:2},{value:"Intro to virtio-scsi",id:"intro-to-virtio-scsi",level:2},{value:"How to add TRIM support to OpenStack Glance",id:"how-to-add-trim-support-to-openstack-glance",level:2},{value:"Required Image Metadata",id:"required-image-metadata",level:3},{value:"<strong><code>hw_scsi_model=virtio-scsi</code></strong>",id:"hw_scsi_modelvirtio-scsi",level:4},{value:"<strong><code>hw_disk_bus=scsi</code></strong>",id:"hw_disk_busscsi",level:4},{value:"Creating an image with fstrim support",id:"creating-an-image-with-fstrim-support",level:2},{value:"Using the OpenStack CLI",id:"using-the-openstack-cli",level:3},{value:"Via Horizon (Web GUI)",id:"via-horizon-web-gui",level:3},{value:"Adding fstrim support to an existing image",id:"adding-fstrim-support-to-an-existing-image",level:2},{value:"Via the OpenStack CLI",id:"via-the-openstack-cli",level:3},{value:"Using Horizon (Web GUI)",id:"using-horizon-web-gui",level:3}],c={toc:p};function d(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"adding-trim-support-to-openstack-glance-images"},"Adding TRIM support to OpenStack Glance images"),(0,n.kt)("h2",{id:"what-is-trim-support"},"What is TRIM Support?"),(0,n.kt)("p",null,"TRIM support is the ability of the virtualization software to pass the TRIM\ncommand from the guest operating system to the underlying physical storage\ndevice. The TRIM command is used to inform the storage device which blocks\nof data are no longer in use and can be safely erased, allowing the device\nto maintain optimal performance over time."),(0,n.kt)("p",null,"Without TRIM support, the storage device would not know which blocks are free\nand which are still in use by the guest operating system. As a result, the\ndevice may not be able to efficiently manage the available storage space,\nleading to decreased performance over time."),(0,n.kt)("h2",{id:"enable-trim-in-vms-using-fstrim"},"Enable TRIM in VMs using ",(0,n.kt)("inlineCode",{parentName:"h2"},"fstrim")),(0,n.kt)("p",null,"Note that to fully benefit from TRIM, it needs to be configured both in the\nGlance image using metadata as well as in your VMs using the SystemD service\n",(0,n.kt)("a",{parentName:"p",href:"https://www.man7.org/linux/man-pages/man8/fstrim.8.html"},(0,n.kt)("inlineCode",{parentName:"a"},"fstrim")),". By\ndefault, this service runs weekly."),(0,n.kt)("h2",{id:"intro-to-virtio-scsi"},"Intro to virtio-scsi"),(0,n.kt)("p",null,"Virtio-scsi is a virtualization interface that allows virtual machines (VMs)\nto communicate with storage devices using a SCSI protocol. One of the main\nbenefits of using virtio-scsi in a virtual environment is its support for the\nTRIM command, which can help to improve the performance and longevity of\nsolid-state drives (SSDs) used as storage devices for VMs."),(0,n.kt)("h2",{id:"how-to-add-trim-support-to-openstack-glance"},"How to add TRIM support to OpenStack Glance"),(0,n.kt)("h3",{id:"required-image-metadata"},"Required Image Metadata"),(0,n.kt)("p",null,"The following metadata is required for the Glance image in order to provide\nTRIM support"),(0,n.kt)("h4",{id:"hw_scsi_modelvirtio-scsi"},(0,n.kt)("strong",{parentName:"h4"},(0,n.kt)("inlineCode",{parentName:"strong"},"hw_scsi_model=virtio-scsi"))),(0,n.kt)("p",null,"This enables the use of VirtIO SCSI (virtio-scsi) to provide block device\naccess for compute instances; by default, instances use VirtIO Block\n(virtio-blk). VirtIO SCSI is a para-virtualized SCSI controller device that\nprovides improved scalability and performance, and supports advanced SCSI hardware."),(0,n.kt)("h4",{id:"hw_disk_busscsi"},(0,n.kt)("strong",{parentName:"h4"},(0,n.kt)("inlineCode",{parentName:"strong"},"hw_disk_bus=scsi"))),(0,n.kt)("p",null,"This specifies the type of disk controller to attach disk devices to. In our\ncase we want to utilize ",(0,n.kt)("inlineCode",{parentName:"p"},"**scsi"),"** for TRIM support."),(0,n.kt)("h2",{id:"creating-an-image-with-fstrim-support"},"Creating an image with fstrim support"),(0,n.kt)("h3",{id:"using-the-openstack-cli"},"Using the OpenStack CLI"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'# Create image with required properties\n$ openstack image create --file <PATH_TO_FILE> \\\n                         --disk-format qcow2 \\\n                         --container-format bare \\\n                         --public \\\n                         --property hw_qemu_guest_agent=yes \\\n                         --property hw_scsi_model=virtio-scsi \\\n                         --property hw_disk_bus=scsi \\\n                         "Trim_Image"\n\n# (Optional) Set distro/version/arch\n$ openstack image set "Trim_Image" \\\n                      --os-distro <DISTRO> \\\n                      --os-version <VERSION> \\\n                      --architecture <ARCH> \\\n')),(0,n.kt)("h3",{id:"via-horizon-web-gui"},"Via Horizon (Web GUI)"),(0,n.kt)("p",null,"When creating a new image within the Horizon web interface, simply select the\nMetadata tab and under \u201c",(0,n.kt)("strong",{parentName:"p"},"libvirt Driver Options for Images"),"\u201d and select the\n\u201c",(0,n.kt)("strong",{parentName:"p"},"+"),"\u201d next to  \u201c",(0,n.kt)("strong",{parentName:"p"},"Disk Bus"),"\u201d and \u201c",(0,n.kt)("strong",{parentName:"p"},"SCSI Model"),"\u201d"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"create-image-metadata.jpg",src:i(56070).Z,width:"4050",height:"3533"})),(0,n.kt)("h2",{id:"adding-fstrim-support-to-an-existing-image"},"Adding fstrim support to an existing image"),(0,n.kt)("h3",{id:"via-the-openstack-cli"},"Via the OpenStack CLI"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"openstack image set <IMAGE_NAME_OR_UUID> \\\n                    --property hw_scsi_model=virtio-scsi \\\n                    --property hw_disk_bus=scsi\n")),(0,n.kt)("h3",{id:"using-horizon-web-gui"},"Using Horizon (Web GUI)"),(0,n.kt)("p",null,"First, select the drop down on the image you want to modify then select\n\u201c",(0,n.kt)("strong",{parentName:"p"},"Update Metadata"),"\u201d"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"select-update-metadata.jpg",src:i(42339).Z,width:"8333",height:"3488"})),(0,n.kt)("p",null,"Next, on the left hand tab under \u201c",(0,n.kt)("strong",{parentName:"p"},"libvirt Driver Options for Images"),"\u201d and\nselect the \u201c",(0,n.kt)("strong",{parentName:"p"},"+"),"\u201d next to  \u201c",(0,n.kt)("strong",{parentName:"p"},"Disk Bus"),"\u201d and \u201c",(0,n.kt)("strong",{parentName:"p"},"SCSI Model"),"\u201d"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"update-image-metadata.jpg",src:i(62605).Z,width:"3200",height:"3492"})))}d.isMDXComponent=!0},56070:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/trim-create-image-metadata-555e0552c5a7a9103c9d875bb9b03e18.jpg"},42339:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/trim-select-update-metadata-3c421b8fe1545ea7bb5a75e2e57be5fb.jpg"},62605:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/trim-update-image-metadata-a1e198519143e0c0e441a2f510a58119.jpg"}}]);