<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">How to Copy and Restore OpenStack Service Databases and Configuration | Openmetal Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://inmotionhosting.github.io/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to Copy and Restore OpenStack Service Databases and Configuration | Openmetal Docs"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><link data-react-helmet="true" rel="icon" href="/openmetal-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://inmotionhosting.github.io/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups"><link data-react-helmet="true" rel="alternate" href="https://inmotionhosting.github.io/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://inmotionhosting.github.io/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups" hreflang="x-default"><link rel="stylesheet" href="/openmetal-docs/assets/css/styles.0b4a7092.css">
<link rel="preload" href="/openmetal-docs/assets/js/runtime~main.d81ccfa3.js" as="script">
<link rel="preload" href="/openmetal-docs/assets/js/main.106e4622.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openmetal-docs/"><div class="navbar__logo"><img src="/openmetal-docs/img/openmetal.svg" alt="Openmetal" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/openmetal-docs/img/openmetal.svg" alt="Openmetal" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/inmotionhosting/openmetal-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_TwRn" href="/openmetal-docs/docs/users_manual/">User&#x27;s Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;User&#x27;s Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_TwRn" href="/openmetal-docs/docs/operators-manual/">Operator&#x27;s Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operator&#x27;s Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-1/command-line/create-ssh-key">Day 1</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-2/resource-usage/cloud-resource-usage">Day 2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-3/add-provider-ips">Day 3</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-3/add-provider-ips">How to Add Additional Provider IP Blocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-3/add-remove-hardware-nodes">How to Add or Remove OpenStack Hardware Nodes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups">How to Copy and Restore OpenStack Service Databases and Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-3/create-volume-backups">Create and Restore Volume Backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-3/disaster-recovery">OpenStack Disaster Planning, Testing, and Recovery</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/openmetal-docs/docs/operators-manual/day-4/automation/heat">Day 4</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_TwRn" href="/openmetal-docs/docs/operators-manual-extras/">Operator&#x27;s Manual Extras</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operator&#x27;s Manual Extras&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/openmetal-docs/docs/how-to-guides/horizon/live-migrate-instance">How to Guides</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to Copy and Restore OpenStack Service Databases and Configuration</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>Your OpenMetal private cloud is comprised of OpenStack services, which
like the applications and services you might deploy inside of it, should
be backed up on a regular interval so you can recover from catastrophic
events. In this guide, we explain how to copy your cloud&#x27;s configuration
files and OpenStack service databases as well as how to restore these
items.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="before-proceeding-with-this-guide">Before Proceeding with this Guide<a class="hash-link" href="#before-proceeding-with-this-guide" title="Direct link to heading">​</a></h2><p>This guide introduces potentially harmful commands and actions that
could cause the cloud to become inoperable or be in an unexpected state.
Read commands carefully before executing them.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="table-of-contents">Table of Contents<a class="hash-link" href="#table-of-contents" title="Direct link to heading">​</a></h2><ol><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#kolla-ansible-and-ceph-ansible">Kolla Ansible and Ceph
Ansible</a></p><ol><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#prepare-kolla-ansible-and-ceph-ansible-environment">Prepare Kolla Ansible and Ceph Ansible
Environment</a></p></li><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#where-are-my-private-cloud-s-configuration-files">Where are my Private Cloud&#x27;s Configuration
Files?</a></p><ol><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#kolla-ansible-configuration-files">Kolla Ansible Configuration
Files</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#ceph-ansible-configuration-files">Ceph Ansible Configuration
Files</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#fm-deploy-configuration-file">FM-Deploy Configuration
File</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#network-ansible-configuration-file">Network Ansible Configuration
File</a></li></ol></li></ul></li><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#keep-a-backup-copy-a-private-cloud-s-configuration-files">Keep a Backup Copy a Private Cloud&#x27;s Configuration
Files</a></p></li></ol></li></ul></li><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#how-to-restore-a-private-cloud-s-configuration-files">How to Restore a Private Cloud&#x27;s Configuration
Files</a></p><ol><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#example-recover-neutron-s-configuration-file-using-kolla-ansible">Example: Recover Neutron&#x27;s Configuration File using
Kolla
Ansible</a></p><ol><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#prerequisite-prepare-a-kolla-ansible-environment">Prerequisite: Prepare a Kolla Ansible
Environment</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#regenerate-an-openstack-service-s-configuration-file-using-kolla-ansible">Regenerate an OpenStack Service&#x27;s Configuration
File using Kolla
Ansible</a></li></ol></li></ul></li></ol></li></ul></li><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#create-full-and-incremental-copies-of-a-private-cloud-s-openstack-service-databases">Create Full and Incremental Copies of a Private Cloud&#x27;s
OpenStack Service
Databases</a></p><ol><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#prerequisites">Prerequisites</a></p></li><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#how-to-create-openstack-service-database-backups">How to Create OpenStack Service Database
Backups</a></p><ol><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#command-syntax-for-full-database-backups">Command Syntax for Full Database
Backups</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#command-syntax-for-incremental-database-backups">Command Syntax for Incremental Database
Backups</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#path-to-the-kolla-ansible-inventory-file">Path to the Kolla Ansible Inventory
File</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#command-usage-example-for-a-full-database-backup">Command Usage Example for a Full Database
Backup</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#command-usage-example-for-an-incremental-database-backup">Command Usage Example for an Incremental Database
Backup</a></li></ol></li></ul></li></ol></li></ul></li><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#how-to-restore-a-private-cloud-s-openstack-service-databases">How to Restore a Private Cloud&#x27;s OpenStack Service
Databases</a></p><ol><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#full-database-restoration-steps">Full Database Restoration
Steps</a></p><ol><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#full-restoration-create-temporary-docker-container">Full Restoration: Create Temporary Docker
Container</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#full-restoration-prepare-backup-directory">Full Restoration: Prepare Backup
Directory</a></li></ol></li></ul></li><li><ul><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#incremental-database-restoration-steps">Incremental Database Restoration
Steps</a></p><ol><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#incremental-restoration-create-temporary-docker-container">Incremental Restoration: Create Temporary Docker
Container</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#incremental-restoration-prepare-backup-directory">Incremental Restoration: Prepare Backup
Directory</a></li></ol></li></ul></li></ol></li></ul></li><li><p><a href="/openmetal-docs/docs/operators-manual/day-3/create-openstack-service-backups#references">References</a></p></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="kolla-ansible-and-ceph-ansible">Kolla Ansible and Ceph Ansible<a class="hash-link" href="#kolla-ansible-and-ceph-ansible" title="Direct link to heading">​</a></h2><p>Kolla Ansible is responsible for deploying a Private Cloud&#x27;s OpenStack
services. Ceph Ansible then handles deployment of the cloud&#x27;s Ceph
cluster. These two systems deploy all OpenStack and Ceph services
required for a Private Cloud, including their configurations.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="prepare-kolla-ansible-and-ceph-ansible-environment">Prepare Kolla Ansible and Ceph Ansible Environment<a class="hash-link" href="#prepare-kolla-ansible-and-ceph-ansible-environment" title="Direct link to heading">​</a></h3><p>Before working with either Kolla Ansible or Ceph Ansible, you must
prepare an environment in your shell:</p><ul><li><a href="/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/">How to Prepare and Use Kolla
Ansible</a></li><li><a href="/openmetal-docs/docs/operators-manual/day-4/ceph-ansible/">How to Prepare and Use Ceph
Ansible</a></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="where-are-my-private-clouds-configuration-files">Where are my Private Cloud&#x27;s Configuration Files?<a class="hash-link" href="#where-are-my-private-clouds-configuration-files" title="Direct link to heading">​</a></h3><p>When a cloud finishes deploying, the Ansible configurations used to
deploy the cloud are exported into each of the control plane nodes
within the folders <code>/etc/fm-deploy</code> and <code>/etc/kolla</code>. This section
explains where configuration files are located and their purpose.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="kolla-ansible-configuration-files">Kolla Ansible Configuration Files<a class="hash-link" href="#kolla-ansible-configuration-files" title="Direct link to heading">​</a></h4><p>The information in these files was used to deploy your Private Cloud&#x27;s
core OpenStack services into Docker containers:</p><ul><li>Kolla Ansible Inventory: <code>/etc/fm-deploy/kolla-ansible-inventory</code></li><li>Kolla Ansible Main Configuration: <code>/etc/kolla/globals.yml</code></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ceph-ansible-configuration-files">Ceph Ansible Configuration Files<a class="hash-link" href="#ceph-ansible-configuration-files" title="Direct link to heading">​</a></h4><p>The information in these files was used to deploy your Private Cloud&#x27;s
Ceph cluster:</p><ul><li>Ceph Ansible Inventory: <code>/etc/fm-deploy/ceph-inventory.yml</code></li><li>Ceph Ansible Main Configuration: <code>/etc/fm-deploy/ceph-vars.yml</code></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="fm-deploy-configuration-file">FM-Deploy Configuration File<a class="hash-link" href="#fm-deploy-configuration-file" title="Direct link to heading">​</a></h4><p>FM-Deploy is a part of the system used to deploy your Private Cloud.
Information about this deployment system is provided for the sake of
completely explaining the configuration files found within
<code>/etc/fm-deploy</code>.</p><ul><li>FM-Deploy Main Configuration: <code>/etc/fm-deploy/config.yml</code></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="network-ansible-configuration-file">Network Ansible Configuration File<a class="hash-link" href="#network-ansible-configuration-file" title="Direct link to heading">​</a></h4><p>The following defines the initial networking configuration for your
Private Cloud. This file was used upon initial cloud deployment.</p><ul><li>Inventory: <code>/etc/fm-deploy/network-inventory.yml</code></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="keep-a-backup-copy-a-private-clouds-configuration-files">Keep a Backup Copy a Private Cloud&#x27;s Configuration Files<a class="hash-link" href="#keep-a-backup-copy-a-private-clouds-configuration-files" title="Direct link to heading">​</a></h3><p>In case something unexpected happens to these files, you should keep
copies of them off site. To preserve the configuration of OpenStack
services and Ceph, copy the directories <code>/etc/fm-deploy</code>, <code>/etc/kolla</code>
and <code>/etc/ceph</code> somewhere outside of the cloud, in a secure, private
location. These folders contain sensitive information about your cloud
so the information within should only be accessible to those you trust
or yourself.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-restore-a-private-clouds-configuration-files">How to Restore a Private Cloud&#x27;s Configuration Files<a class="hash-link" href="#how-to-restore-a-private-clouds-configuration-files" title="Direct link to heading">​</a></h2><p>There are two primary ways a Private Cloud&#x27;s configuration file can be
restored: Copy a known good configuration file from an off site location
or use Ansible. This section explains how you can use Kolla Ansible and
Ceph Ansible to recover a Private Cloud&#x27;s configuration files.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="example-recover-neutrons-configuration-file-using-kolla-ansible">Example: Recover Neutron&#x27;s Configuration File using Kolla Ansible<a class="hash-link" href="#example-recover-neutrons-configuration-file-using-kolla-ansible" title="Direct link to heading">​</a></h3><p>For example, consider an event where one of your control plane nodes
loses its Neutron server configuration file. This section explains how
to recover this configuration by using Kolla Ansible.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="prerequisite-prepare-a-kolla-ansible-environment">Prerequisite: Prepare a Kolla Ansible Environment<a class="hash-link" href="#prerequisite-prepare-a-kolla-ansible-environment" title="Direct link to heading">​</a></h4><p>Before proceeding, a Kolla Ansible environment needs to be prepared. For
information about preparing a Kolla Ansible environment, see <a href="/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/">How to
Prepare and Use Kolla
Ansible</a>. Once
the environment is prepared, navigate back to this section.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="regenerate-an-openstack-services-configuration-file-using-kolla-ansible">Regenerate an OpenStack Service&#x27;s Configuration File using Kolla Ansible<a class="hash-link" href="#regenerate-an-openstack-services-configuration-file-using-kolla-ansible" title="Direct link to heading">​</a></h4><p>In this example, we outline restoring the Neutron server configuration
file for the control plane node <code>relaxed-flamingo</code>.</p><p>In the Kolla Ansible inventory file,
<code>/etc/fm-deploy/kolla-ansible-inventory</code>, the following hosts are
defined as control plane nodes under the heading <code>[control]</code>:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[control]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">relaxed-flamingo ansible_host=10.204.28.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">focused-capybara ansible_host=10.204.30.158</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lovely-ladybug ansible_host=10.204.25.253</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To restore the Neutron server configuration file for <code>relaxed-flamingo</code>,
first ensure you have <a href="/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/">prepared a Kolla Ansible
environment</a>.</p><p>Next, use Kolla Ansible&#x27;s <code>reconfigure</code> function, targeting only the
Neutron service by using the flag <code>--tags neutron</code> and limit the run to
the host <code>relaxed-flamingo</code> by specifying the flag <code>--limit control[0]</code>.</p><p>For example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kolla-ansible \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -i /etc/fm-deploy/kolla-ansible-inventory \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reconfigure \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --tags neutron \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --limit control[0]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="create-full-and-incremental-copies-of-a-private-clouds-openstack-service-databases">Create Full and Incremental Copies of a Private Cloud&#x27;s OpenStack Service Databases<a class="hash-link" href="#create-full-and-incremental-copies-of-a-private-clouds-openstack-service-databases" title="Direct link to heading">​</a></h2><p>Kolla Ansible provides a utility to create copies of all OpenStack
service databases, called <code>mariadb_backup</code>. In this section, we explain
how to use Kolla Ansible&#x27;s builtin function to create database backups
of a Private Cloud&#x27;s OpenStack services.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h3><p>Before proceeding with this guide, a Kolla Ansible environment needs to
be prepared. For information about preparing a Kolla Ansible
environment, see <a href="/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/">How to Prepare and Use Kolla
Ansible</a>. Once
the environment is prepared, come back to this guide to learn how to
create database backups of OpenStack services.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-create-openstack-service-database-backups">How to Create OpenStack Service Database Backups<a class="hash-link" href="#how-to-create-openstack-service-database-backups" title="Direct link to heading">​</a></h3><p>The following instruction must be performed from the folder in which you
have prepared Kolla Ansible. This section first provides the command
syntax, then follows up with an example of the command&#x27;s execution and
output. Note that Kolla Ansible has no way to schedule backups.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="command-syntax-for-full-database-backups">Command Syntax for Full Database Backups<a class="hash-link" href="#command-syntax-for-full-database-backups" title="Direct link to heading">​</a></h4><p>The command to perform a full backup of all databases using Kolla
Ansible is...:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kolla-ansible -i &lt;inventory&gt; mariadb_backup</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>...where <code>&lt;inventory&gt;</code> is the path to the Kolla Ansible inventory file.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="command-syntax-for-incremental-database-backups">Command Syntax for Incremental Database Backups<a class="hash-link" href="#command-syntax-for-incremental-database-backups" title="Direct link to heading">​</a></h4><p>The command to perform an incremental backup of all databases using
Kolla Ansible is...:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kolla-ansible -i &lt;inventory&gt; mariadb_backup --incremental</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>...where <code>&lt;inventory&gt;</code> is the path to the Kolla Ansible inventory file.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="path-to-the-kolla-ansible-inventory-file">Path to the Kolla Ansible Inventory File<a class="hash-link" href="#path-to-the-kolla-ansible-inventory-file" title="Direct link to heading">​</a></h4><p>The Kolla Ansible inventory file is located across all control plane
nodes as:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/fm-deploy/kolla-ansible-inventory</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="command-usage-example-for-a-full-database-backup">Command Usage Example for a Full Database Backup<a class="hash-link" href="#command-usage-example-for-a-full-database-backup" title="Direct link to heading">​</a></h4><p>From the host that has Kolla Ansible prepared, the following command is
executed:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kolla-ansible -i /etc/fm-deploy/kolla-ansible-inventory mariadb_backup</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Truncated output of the above command:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># kolla-ansible -i /etc/fm-deploy/kolla-ansible-inventory mariadb_backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Backup MariaDB databases : ansible-playbook -i /etc/fm-deploy/kolla-ansible-inventory -e @/etc/kolla/globals.yml  -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  -e kolla_action=backup -e mariadb_backup_type=full /opt/kolla-ansible/.venv/share/kolla-ansible/ansible/mariadb_backup.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...previous output truncated...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [mariadb : Taking full database backup via Mariabackup] **************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skipping: [focused-capybara]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skipping: [lovely-ladybug]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARNING]: The value False (type bool) in a string field was converted to &#x27;False&#x27; (type string). If this does not look like what you expect, quote the entire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value to ensure it does not change.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [relaxed-flamingo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP ****************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">focused-capybara           : ok=2    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lovely-ladybug             : ok=2    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">relaxed-flamingo           : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The task <code>[mariadb : Taking full database backup via Mariabackup]</code> is
where a backup of all OpenStack service databases is created. Kolla
Ansible creates a Docker volume called <code>mariadb_backup</code> to store the
database copies. Previous backups made using this method are not
overwritten. The host under this task that reports a change (example:
<code>changed=1</code>) is where the Docker volume storing the databases is
created.</p><p><strong>Note<!-- -->!</strong> -- For this example, since the Docker volume was created on
another host, the remaining instruction in this guide must be performed
from that host. If Kolla Ansible creates <code>mariadb_backup</code> on another
host, you must SSH into that host as root to continue this process.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="command-usage-example-for-an-incremental-database-backup">Command Usage Example for an Incremental Database Backup<a class="hash-link" href="#command-usage-example-for-an-incremental-database-backup" title="Direct link to heading">​</a></h4><p><strong>Note<!-- -->!</strong> -- Incremental backups can only be made if a full backup has
been made prior, otherwise the following command will result in an
error.</p><p>From the host that has Kolla Ansible prepared, the following command is
executed:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">kolla-ansible -i /etc/fm-deploy/kolla-ansible-inventory mariadb_backup \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --incremental</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Truncated output of the above command:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># kolla-ansible -i /etc/fm-deploy/kolla-ansible-inventory mariadb_backup --incremental</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Backup MariaDB databases : ansible-playbook -i /etc/fm-deploy/kolla-ansible-inventory -e @/etc/kolla/globals.yml  -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  -e kolla_action=backup -e mariadb_backup_type=incremental /opt/kolla-ansible/.venv/share/kolla-ansible/ansible/mariadb_backup.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...previous output truncated...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [mariadb : include_tasks] ****************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">included: /opt/kolla-ansible/.venv/share/kolla-ansible/ansible/roles/mariadb/tasks/backup.yml for relaxed-flamingo, focused-capybara, lovely-ladybug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [mariadb : Taking incremental database backup via Mariabackup] ***************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skipping: [focused-capybara]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skipping: [lovely-ladybug]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARNING]: The value False (type bool) in a string field was converted to &#x27;False&#x27; (type string). If this does not look like what you expect, quote the entire value to ensure it does not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [relaxed-flamingo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP ************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">focused-capybara           : ok=2    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lovely-ladybug             : ok=2    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">relaxed-flamingo           : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The task <code>[mariadb : Taking incremental database backup via
Mariabackup]</code> is where an incremental backup of all OpenStack service
databases is created. Kolla Ansible creates a Docker volume called
<code>mariadb_backup</code> to store the database copies. Previous backups made
using this method are not overwritten. The host under this task that
reports a change (example: <code>changed=1</code>) is where the Docker volume
storing the databases is created.</p><p><strong>Note<!-- -->!</strong> -- For this example, since the Docker volume was created on
another host, the remaining instruction in this guide must be performed
from that host. If Kolla Ansible creates <code>mariadb_backup</code> on another
host, you must SSH into that host as root to continue this process.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-restore-a-private-clouds-openstack-service-databases">How to Restore a Private Cloud&#x27;s OpenStack Service Databases<a class="hash-link" href="#how-to-restore-a-private-clouds-openstack-service-databases" title="Direct link to heading">​</a></h2><p>This section explains how to restore both <strong>full</strong> and <strong>incremental</strong>
database backups created using Kolla Ansible&#x27;s <code>mariadb_backup</code>
function.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="full-database-restoration-steps">Full Database Restoration Steps<a class="hash-link" href="#full-database-restoration-steps" title="Direct link to heading">​</a></h3><p>Follow these steps to learn how to restore full OpenStack service
databases created using Kolla Ansible&#x27;s <code>mariadb_backup</code> function.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="full-restoration-create-temporary-docker-container">Full Restoration: Create Temporary Docker Container<a class="hash-link" href="#full-restoration-create-temporary-docker-container" title="Direct link to heading">​</a></h4><p>In this section, we create a temporary Docker container called
<code>dbrestore</code>. This container is created with the same volumes as the
<code>mariadb</code> Docker container. The <code>mariadb_backup</code> Docker volume is
mounted as <code>/backup</code> in this container. Finally, the container is
created using the <code>kolla/centos-binary-mariadb:victoria</code> Docker image
available from Docker Hub with a Bash shell.</p><p>Create the temporary Docker container called <code>dbrestore</code> using:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --rm -it --volumes-from mariadb --name dbrestore \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --volume mariadb_backup:/backup \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kolla/centos-binary-mariadb:victoria \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /bin/bash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Once you run the above Docker command, your terminal should appear this
way:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">()[mysql@06ab93fb83a3 /]$</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="full-restoration-prepare-backup-directory">Full Restoration: Prepare Backup Directory<a class="hash-link" href="#full-restoration-prepare-backup-directory" title="Direct link to heading">​</a></h4><p><strong>Caution<!-- -->!</strong> -- Be careful when using commands. The following commands
make use of the <code>rm</code> command which deletes files.</p><p>Next, the backup data must be prepared before it can be copied into
place.</p><p>This example uses a full MariaDB backup called
<code>mysqlbackup-08-12-2021-1638999340.qp.xbc.xbs.gz</code>.</p><p>To prepare the backup data, in the Docker container, run:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">cd /backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /backup/restore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /backup/restore/full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gunzip mysqlbackup-08-12-2021-1638999340.qp.xbc.xbs.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mbstream -x -C /backup/restore/full/ &lt; mysqlbackup-08-12-2021-1638999340.qp.xbc.xbs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mariabackup --prepare --target-dir /backup/restore/full</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Load another shell session for the node in which you are working and
stop the MariaDB Docker container:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker stop mariadb</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Navigate back to the Docker container and run:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/lib/mysql/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/lib/mysql/\.[^\.]*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mariabackup --copy-back --target-dir /backup/restore/full</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, navigate back to the other shell and start the MariaDB Docker
container:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker start mariadb</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Examine MariaDB&#x27;s logs to confirm the Galera cluster has synchronized:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># tail -1 /var/log/kolla/mariadb/mariadb.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-12-08 22:27:39 2 [Note] WSREP: Synchronized with group, ready for</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connections</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="incremental-database-restoration-steps">Incremental Database Restoration Steps<a class="hash-link" href="#incremental-database-restoration-steps" title="Direct link to heading">​</a></h3><p>Follow these steps to learn how to restore an incremental OpenStack
service database backup created using Kolla Ansible&#x27;s <code>mariadb_backup</code>
function.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="incremental-restoration-create-temporary-docker-container">Incremental Restoration: Create Temporary Docker Container<a class="hash-link" href="#incremental-restoration-create-temporary-docker-container" title="Direct link to heading">​</a></h4><p>In this section, we create a temporary Docker container called
<code>dbrestore</code>. This container is created with the same volumes as the
<code>mariadb</code> Docker container. The <code>mariadb_backup</code> Docker volume is
mounted as <code>/backup</code> in this container. Finally, the container is
created using the <code>kolla/centos-binary-mariadb:victoria</code> Docker image
available from Docker Hub with a Bash shell.</p><p>Create the temporary Docker container called <code>dbrestore</code> using:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --rm -it \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --volumes-from mariadb \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --name dbrestore \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --volume mariadb_backup:/backup \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kolla/centos-binary-mariadb:victoria \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /bin/bash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Once you run the above Docker command, your terminal should appear this
way:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">()[mysql@06ab93fb83a3 /]$</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="incremental-restoration-prepare-backup-directory">Incremental Restoration: Prepare Backup Directory<a class="hash-link" href="#incremental-restoration-prepare-backup-directory" title="Direct link to heading">​</a></h4><p><strong>Caution<!-- -->!</strong> -- Be careful when using commands. The following commands
make use of the <code>rm</code> command which deletes files.</p><p>This section assumes a full and incremental backup have been created.
Note that your full and incremental backup file names will differ from
this example.</p><p>Next, we must prepare the backup data before it can be copied into
place.</p><p>In the Docker container, run:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">cd /backup/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /backup/restore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /backup/restore/full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /backup/restore/incremental</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gunzip mysqlbackup-10-12-2021-1639166052.qp.xbc.xbs.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gunzip incremental-20-mysqlbackup-10-12-2021-1639169695.qp.xbc.xbs.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mbstream -x -C /backup/restore/full/ &lt; mysqlbackup-10-12-2021-1639166052.qp.xbc.xbs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mbstream -x -C /backup/restore/incremental/ &lt; incremental-20-mysqlbackup-10-12-2021-1639169695.qp.xbc.xbs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mariabackup --prepare --target-dir=/backup/restore/full/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mariabackup --prepare --target-dir=/backup/restore/full/ --incremental-dir=/backup/restore/incremental/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Load another shell session for the node in which you are working and
stop the MariaDB Docker container:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker stop mariadb</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Navigate back to the Docker container and run:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/lib/mysql/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/lib/mysql/\.[^/.]*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mariabackup --copy-back --target-dir /backup/restore/full/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, navigate back to the other shell and start the MariaDB Docker
container:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">docker start mariadb</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Examine MariaDB&#x27;s logs to confirm the Galera cluster has synchronized:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># tail -1 /var/log/kolla/mariadb/mariadb.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-12-08 22:27:39 2 [Note] WSREP: Synchronized with group, ready for</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connections</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li>Kolla Ansible&#x27;s <a href="https://docs.openstack.org/kolla-ansible/victoria/admin/mariadb-backup-and-restore.html" target="_blank" rel="noopener noreferrer">MariaDB database backup and
restore</a></li><li>MariaDB&#x27;s <a href="https://mariadb.com/kb/en/full-backup-and-restore-with-mariabackup/" target="_blank" rel="noopener noreferrer">Full Backup and Restore with
Mariabackup</a></li><li>MariaDB&#x27;s <a href="https://mariadb.com/kb/en/incremental-backup-and-restore-with-mariabackup/" target="_blank" rel="noopener noreferrer">Incremental Backup and Restore with
Mariabackup</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/inmotionhosting/openmetal-docs/blob/main/docs/operators-manual/day-3/create-openstack-service-backups.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/openmetal-docs/docs/operators-manual/day-3/add-remove-hardware-nodes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How to Add or Remove OpenStack Hardware Nodes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/openmetal-docs/docs/operators-manual/day-3/create-volume-backups"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Create and Restore Volume Backups</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#before-proceeding-with-this-guide" class="table-of-contents__link toc-highlight">Before Proceeding with this Guide</a></li><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#kolla-ansible-and-ceph-ansible" class="table-of-contents__link toc-highlight">Kolla Ansible and Ceph Ansible</a><ul><li><a href="#prepare-kolla-ansible-and-ceph-ansible-environment" class="table-of-contents__link toc-highlight">Prepare Kolla Ansible and Ceph Ansible Environment</a></li><li><a href="#where-are-my-private-clouds-configuration-files" class="table-of-contents__link toc-highlight">Where are my Private Cloud&#39;s Configuration Files?</a></li><li><a href="#keep-a-backup-copy-a-private-clouds-configuration-files" class="table-of-contents__link toc-highlight">Keep a Backup Copy a Private Cloud&#39;s Configuration Files</a></li></ul></li><li><a href="#how-to-restore-a-private-clouds-configuration-files" class="table-of-contents__link toc-highlight">How to Restore a Private Cloud&#39;s Configuration Files</a><ul><li><a href="#example-recover-neutrons-configuration-file-using-kolla-ansible" class="table-of-contents__link toc-highlight">Example: Recover Neutron&#39;s Configuration File using Kolla Ansible</a></li></ul></li><li><a href="#create-full-and-incremental-copies-of-a-private-clouds-openstack-service-databases" class="table-of-contents__link toc-highlight">Create Full and Incremental Copies of a Private Cloud&#39;s OpenStack Service Databases</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#how-to-create-openstack-service-database-backups" class="table-of-contents__link toc-highlight">How to Create OpenStack Service Database Backups</a></li></ul></li><li><a href="#how-to-restore-a-private-clouds-openstack-service-databases" class="table-of-contents__link toc-highlight">How to Restore a Private Cloud&#39;s OpenStack Service Databases</a><ul><li><a href="#full-database-restoration-steps" class="table-of-contents__link toc-highlight">Full Database Restoration Steps</a></li><li><a href="#incremental-database-restoration-steps" class="table-of-contents__link toc-highlight">Incremental Database Restoration Steps</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/openmetal-docs/img/openmetal.svg" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/openmetal-docs/img/openmetal.svg" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></div><div class="footer__copyright"><strong>2022 © OpenMetal, a division of <a href="https://www.inmotionhosting.com" target="_blank" rel="noopener">InMotion Hosting</a>.  All rights reserved.</strong></div></div><div class="footerContact_lPaK"><p>555 S. Independence Blvd, Virginia Beach, VA 23452</p><div class="contactLinks_EKti"><a href="tel:+18777289664">877-7-BUY-OMI</a><a href="mailto:sales@openmetal.io">sales@openmetal.io</a><a href="https://openmetal.io/schedule-meeting/">Schedule a Demo</a></div><p><strong>OpenMetal Central:</strong> <a target="_blank" href="https://central.openmetal.io/auth/sign-in">Login</a> or <a target="_blank" href="https://central.openmetal.io/sign-up">Create New Account</a></p></div></div></footer></div>
<script src="/openmetal-docs/assets/js/runtime~main.d81ccfa3.js"></script>
<script src="/openmetal-docs/assets/js/main.106e4622.js"></script>
</body>
</html>